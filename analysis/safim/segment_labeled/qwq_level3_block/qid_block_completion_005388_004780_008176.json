{
  "segments": [
    {
      "text": "Okay, let's tackle these three programs one by one. Starting with program1.py. The problem is to find the maximum beauty of a proper subsegment.",
      "start_char": 0,
      "end_char": 146,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The beauty is calculated as the difference between max and min of the elements outside the subsegment plus the difference between max and min of the subsegment itself.",
      "start_char": 147,
      "end_char": 314,
      "label": "code_analysis",
      "label_info": {
        "type": "code_analysis"
      }
    },
    {
      "text": "Hmm, the key here is to compute this efficiently because the array can be up to 1e5 elements, and with multiple test cases, a naive approach would be too slow. First, I need to think about how to compute the max and min for the parts outside the subsegment [l, r].",
      "start_char": 315,
      "end_char": 580,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The straightforward way would be for each possible l and r, compute the max and min of the entire array except the subsegment. But that's O(n^2), which is way too slow for n=1e5. Wait, maybe precompute prefix and suffix max and min arrays. Like, for each position i, have the max from the start up to i, and the max from i to the end. Similarly for min.",
      "start_char": 581,
      "end_char": 935,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Then, for any l and r, the combined max and min outside would be the max of (prefix_max[l-1], suffix_max[r+1]) and similarly for min. Wait, actually, the outside part is the elements before l and after r. So the max of the outside is the maximum between the max of the first l-1 elements and the max of the elements from r+1 to n. Similarly for the min. So, to precompute these, we can have:\n\nprefix_max array where prefix_max[i] is the maximum from a[0] to a[i]. prefix_min array where prefix_min[i] is the minimum from a[0] to a[i]. Similarly, suffix_max[i] is the maximum from a[i] to a[n-1]. suffix_min[i] is the minimum from a[i] to a[n-1].",
      "start_char": 936,
      "end_char": 1586,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Then, for a subsegment from l to r (0-based?), the outside max would be max( prefix_max[l-1], suffix_max[r+1] ), and the outside min would be min( prefix_min[l-1], suffix_min[r+1] ).",
      "start_char": 1588,
      "end_char": 1770,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The inside part's max and min can be found by another precomputed array for ranges. But how?\n\nAlternatively, for the inside part (the subsegment l to r), we need the max and min of a[l..r].",
      "start_char": 1771,
      "end_char": 1960,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute this quickly for any l and r, we can use a segment tree or a sparse table for range max and min queries. But even with that, for each possible l and r, doing a query would be O(1) with sparse tables, but the total number of l and r pairs is O(n^2), which is still too big. Hmm, so maybe there's a smarter way. Let's think of the maximum possible beauty. The beauty is (outside_max - outside_min) + (inside_max - inside_min).",
      "start_char": 1961,
      "end_char": 2397,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To maximize this, perhaps the best is when the outside_max is as large as possible, outside_min as small as possible, and the inside's max and min also contribute.",
      "start_char": 2398,
      "end_char": 2561,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, maybe the maximum beauty is simply (global_max - global_min) + (max_subsegment - min_subsegment). But that's only if the subsegment is chosen such that the outside includes the global max and min, and the subsegment also has its own max and min. Wait, but the subsegment can't be the entire array, so the outside would be empty?",
      "start_char": 2564,
      "end_char": 2907,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, the problem states that it's a proper subsegment, so the subsegment can't be the entire array. So the outside is non-empty.",
      "start_char": 2908,
      "end_char": 3037,
      "label": "test_generation",
      "label_info": {
        "type": "test_generation"
      }
    },
    {
      "text": "Wait, the outside is the elements not in the subsegment. So the outside must have at least one element. So the outside's max and min are valid.",
      "start_char": 3040,
      "end_char": 3183,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, perhaps the maximum possible beauty is (global_max - global_min) plus the maximum possible (inside_max - inside_min) for any subsegment. But that might not be correct because the outside's max and min could be different when the subsegment is chosen.",
      "start_char": 3186,
      "end_char": 3441,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, maybe the maximum beauty is (global_max - global_min) plus the maximum (inside_max - inside_min) of any possible subsegment.",
      "start_char": 3444,
      "end_char": 3583,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Because the outside's max and min would be the global ones, so their difference is fixed. But then the inside's difference can be added. But that would only be possible if the subsegment doesn't include the global max or min. Wait, but if the subsegment includes the global max, then the outside's max would be less than the global max. So that approach might not work.",
      "start_char": 3584,
      "end_char": 3953,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, perhaps the maximum beauty is the maximum over all possible subsegments of ( (max_outside - min_outside) + (max_inside - min_inside) ). To compute this efficiently, we need a way to compute for all possible subsegments the four values quickly.",
      "start_char": 3956,
      "end_char": 4204,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, maybe the maximum possible value of (max_outside - min_outside) is the global_max - global_min, which can be achieved by choosing a subsegment that excludes at least one element from the global max and min. Wait, but if the subsegment excludes the global max, then the outside's max would be the next highest, so maybe not.",
      "start_char": 4207,
      "end_char": 4545,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment. But that's only possible if the subsegment's inside doesn't include the global max or min. Not sure.",
      "start_char": 4548,
      "end_char": 4790,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, maybe the maximum beauty is (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment.",
      "start_char": 4793,
      "end_char": 4932,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Because the outside's max and min can be the global ones, so their difference is fixed. But the subsegment can be any proper subsegment.",
      "start_char": 4933,
      "end_char": 5069,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, but the subsegment can't be the entire array, so the outside is non-empty. So if the subsegment is the entire array except one element, then the outside is that one element. So the outside's max and min would be that element. So in that case, the outside's difference is zero. Hmm, this is getting complicated.",
      "start_char": 5070,
      "end_char": 5388,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Maybe the optimal subsegment is such that the outside has the global max and min, so their difference is (global_max - global_min), and the inside has its own max and min. So the total would be (global_max - global_min) + (max_inside - min_inside). To maximize this, we need the inside's max and min to be as large as possible.",
      "start_char": 5389,
      "end_char": 5716,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum possible beauty is (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment.",
      "start_char": 5719,
      "end_char": 5869,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Because the outside can be arranged to have the global max and min. \n\nWait, but how can the outside have the global max and min?",
      "start_char": 5870,
      "end_char": 5998,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The subsegment must exclude at least one element. So if the subsegment doesn't include the element with the global max, then the outside's max is the global max.",
      "start_char": 5999,
      "end_char": 6160,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Similarly, if the subsegment doesn't include the element with the global min, then the outside's min is the global min. So to have both, the subsegment must exclude at least one element that is not the global max or min. Wait, maybe the subsegment can exclude the global max, but include the global min. Then the outside's max would be less than the global max.",
      "start_char": 6161,
      "end_char": 6522,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, perhaps the best approach is to precompute for all possible subsegments the four values, but that's O(n^2), which is not feasible. Alternative idea: The maximum beauty can be obtained by considering two cases:\n\n1.",
      "start_char": 6525,
      "end_char": 6745,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The subsegment is such that the outside includes the global max and min. Then the outside's difference is (global_max - global_min). The inside's difference can be anything. So the total is (global_max - global_min) + (max_inside - min_inside). To maximize this, we need the maximum (max_inside - min_inside) over all possible subsegments. 2.",
      "start_char": 6746,
      "end_char": 7088,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The subsegment excludes either the global max or the global min, so the outside's difference is less than (global_max - global_min). But maybe in some cases, the inside's difference is so large that the total is better. So the maximum between these two cases would be the answer. So first, compute the global_max and global_min. Then compute the maximum (max_inside - min_inside) over all possible subsegments. Then the first case gives (global_max - global_min) + (max_diff_inside). But there's also other possibilities where the outside's difference is higher than (global_max - global_min)?",
      "start_char": 7091,
      "end_char": 7684,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "No, because the outside is a subset of the entire array, so their max can't exceed the global_max, and min can't be lower than the global_min. So the maximum possible outside difference is (global_max - global_min).",
      "start_char": 7691,
      "end_char": 7906,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Therefore, the first case is the best possible scenario. So the maximum beauty would be (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment.",
      "start_char": 7909,
      "end_char": 8093,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, but the subsegment must be a proper subsegment. So the entire array is not allowed. So the maximum (max_inside - min_inside) over all proper subsegments. Wait, but the maximum (max_inside - min_inside) for a subsegment could be the same as the global difference.",
      "start_char": 8096,
      "end_char": 8366,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For example, if the entire array's max and min are in a subsegment. But since the subsegment can't be the entire array, then the maximum possible (max_inside - min_inside) would be the same as the global difference only if there exists a proper subsegment that includes both the global max and min. \n\nHmm, but in that case, the outside would exclude at least one element. So the outside's max and min would be the global ones only if the subsegment doesn't exclude the global max or min. \n\nWait, this is getting a bit tangled. Let me think of an example.",
      "start_char": 8367,
      "end_char": 8921,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Take the first sample input given in the problem:\n\nSample Input 1:\n\nSample Input 1:\n\nFirst test case: array [1, 2, 3, 4, 5, 6, 1, 5]. The optimal subsegment is l=7, r=8 (assuming 1-based). The outside is the first 6 elements and the 8th? Wait, maybe the array is 1-based. Let me see the note: the optimal segment is l=7, r=8.",
      "start_char": 8924,
      "end_char": 9249,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The outside would be the first 6 elements and the elements after 8 (but there are none). Wait, the array length is 8? So the outside is the first 6 elements (since r is 8, so r+1 is 9 which is beyond n). So the outside's max is 6 (from the first 6 elements) and min is 1. So their difference is 5. The inside is [1,5], so max 5, min 1, difference 4. Total 5+4=9. The global max is 6, global min is 1. So (6-1) + (5-1) = 5+4=9. So that's exactly the case where the outside includes the global max and min. So the approach of taking (global_max - global_min) plus the maximum (max_inside - min_inside) of any proper subsegment would work here. Another example: the second sample input. The array is [2, 100, 1, 200, 3]. The optimal subsegment is l=2 to 4 (elements 100,1,200). The outside includes the first element (2) and the last (3). The outside's max is 200 (wait, no, the outside is the elements before l=2 (element 2) and after r=4 (element 3). So the outside's elements are 2 and 3. Their max is 3, min is 2. So their difference is 1. The inside's max is 200, min 1. So total is 1 + (200-1) = 200. But according to the note, the answer is (100-2) + (200-1) = 98 + 199 = 297. Wait, that contradicts. Wait, maybe I made a mistake here. Wait the note says the optimal is l=2, r=4. The outside is the elements before l=2 (element 2) and after r=4 (element 3). So the outside elements are 2 and 3. The max of those is 3, min is 2. So their difference is 1. The inside's max is 200, min is 1. So total is 1 + (200-1) = 200. But the note says the beauty is (100-2) + (200-1) = 98 + 199 = 297. Wait, that's different. So my previous approach is wrong. Hmm, so what's wrong here? Let me re-calculate the example. Wait the array in the second test case is [2, 100, 1, 200, 3]. The subsegment is l=2 to r=4 (indices 2,3,4 in 1-based). The outside elements are the first element (2) and the fifth (3). The max of the outside is max(2,3) =3, min is 2. So their difference is 1. The inside elements are 100,1,200. Their max is 200, min is 1. So the total is 1 + (200-1) = 200. But according to the note, the beauty is (100-2) + (200-1) = 98 + 199 = 297. Wait, that's conflicting. Wait, perhaps I misunderstood the problem's description. Let me re-read the problem statement. The beauty is defined as:\n\nmax(a_1 ... a_{l-1}, a_{r+1} ... a_n) minus min of those same elements, plus the max of the subsegment minus the min of the subsegment. Ah! Oh right, the first part is (max of the outside elements) minus (min of the outside elements).",
      "start_char": 9250,
      "end_char": 11796,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The second part is (max of the subsegment) minus (min of the subsegment). So in the second example's case, the outside elements are 2 and 3. Their max is 3, min is 2. So 3-2 =1. The inside's max is 200, min is 1. So 200-1=199. Total is 1+199=200. But the note says the answer is (100-2) + (200-1) = 98+199=297. Wait, that's different. Hmm, so I must have misunderstood the example. Let me check the note again. The note says: \"In the second test case, the optimal segment is l=2, r=4. The beauty equals (100-2) + (200-1) = 297\". Wait, how does that happen? Wait the outside elements are the elements before l=2 (which is the first element, 2) and after r=4 (the fifth element, 3). So the outside elements are 2 and 3. Their max is 3, min is 2. So their difference is 1. The inside's max is 200, min is 1. So the total should be 1 + (200-1) = 200. But the note says 297. Hmm, this suggests that I have a misunderstanding of the problem. Let me re-read the problem's description. Ah! Wait, the first part is the max of the outside elements minus the min of the outside elements.",
      "start_char": 11797,
      "end_char": 12887,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The second part is the max of the subsegment minus the min of the subsegment. Wait in the note's example, the outside's max is 100? No, that can't be. Wait the outside elements are the elements not in the subsegment. The subsegment is from l=2 to r=4. So the outside elements are the first element (2) and the fifth (3). So their max is 3, min is 2. Wait the note's calculation says (100-2) + (200-1). So where does the 100 come from? Wait maybe the subsegment is l=2 to r=4, so the outside includes the first element (2) and the fifth (3). The max of the outside is 3, min is 2. So the first part is 1. The second part is (200-1) =199. So total 200. But the note says 297. Hmm, this discrepancy suggests that I must have misread the problem's example. Let me check the note again. The note says: \"In the second test case, the optimal segment is l=2, r=4. The beauty of this segment equals (100-2) + (200-1) = 297\".",
      "start_char": 12888,
      "end_char": 13813,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, so the first part is 100-2, which would imply that the outside's max is 100 and min is 2. But the outside elements are 2 and 3. So their max is 3, not 100. This is confusing. Maybe the array in the second test case is different? Let me see the note's example again. The note says: \"the optimal segment is l=2, r=4. The beauty equals (100-2) + (200-1) = 297\". Ah! Wait, perhaps the array is [2, 100, 1, 200, 3]. The subsegment is from 2 to 4 (indices 2,3,4 in 1-based). The outside elements are the first element (2) and the fifth (3). The max of the outside is 3, min is 2. So the first part is 1. The second part is (200-1) =199. So total 200. But the note says 297. Hmm, this suggests that perhaps the array is different. Maybe the array is [2, 100, 1, 200, 3, ...] with more elements? Or perhaps I made a mistake in the indices. Alternatively, maybe the problem's note has a typo, but that's unlikely. Alternatively, perhaps the outside includes the elements before l and after r. So for l=2 and r=4, the outside is the elements before l (elements 1) and after r (elements 5 and beyond). So in the array of length 5, the elements after r=4 are element 5. So the outside elements are 2 (element 1) and 3 (element5). Wait, but the first part of the calculation in the note is 100-2. So the outside's max is 100? That can't be. Unless the outside includes the subsegment's elements? No, that's not possible. Hmm, maybe I misunderstood the problem's definition. Let me re-read the problem statement.",
      "start_char": 13816,
      "end_char": 15336,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The problem says: the beauty is the max of the elements outside the subsegment minus the min of those elements, plus the max of the subsegment minus the min of the subsegment. Wait, the first part is the max of the elements not in the subsegment, minus the min of those elements. The second part is the max of the subsegment minus the min of the subsegment. In the second example's note, the first part is (100-2). So the outside's max is 100 and min is 2.",
      "start_char": 15339,
      "end_char": 15799,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "That would mean that the outside includes the element 100. But the subsegment is from 2 to 4, so the element 100 is part of the subsegment. So that can't be. Wait, perhaps the subsegment is l=2 to r=4, so the elements in the subsegment are 100,1,200. The outside elements are the first element (2) and the fifth (3). So their max is 3, min is 2. So the first part is 1. The second part is (200-1)=199. Total 200. But the note says 297. Hmm, this is a problem.",
      "start_char": 15800,
      "end_char": 16261,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Maybe the array in the second test case is different. Let me think again. Wait the note says the second test case's answer is 297. The calculation is (100-2) + (200-1) = 98 + 199 = 297. So the first part is 100-2, which implies that the outside's max is 100 and min is 2. So the outside must include the element 100. But that's part of the subsegment. This is a contradiction. So perhaps the subsegment is l=2 to r=3? Let's see. Then the subsegment is 100 and 1. The outside elements are 2 (before), and 200 and 3 (after). The outside's max is 200, min is 2. So their difference is 198. The subsegment's max is 100, min 1. So total 198 + 99 = 297. That matches the note. Ah! So perhaps the subsegment is l=2 to r=3. Then the outside includes the first element (2), the fourth (200), and fifth (3). So the max is 200, min is 2. So 200-2=198. The subsegment's max is 100, min 1. So 198+99=297. So the note's example must have the subsegment l=2 to r=3. But the note says l=2, r=4. So perhaps there's a mistake in the note's description. Or perhaps I'm misunderstanding the indices. Alternatively, maybe the array is different. Let me think again. Alternatively, maybe the array is [2, 100, 1, 200, 3]. The subsegment l=2 to r=4 (elements 100,1,200). The outside elements are 2 and 3. So their max is 3, min 2. So first part is 1. The subsegment's max is 200, min 1. So total 1+199=200. But the note says 297. Hmm, this is a problem. Maybe I'm missing something. Alternatively, perhaps the outside includes the entire array except the subsegment. So for the subsegment l=2 to r=4, the outside is the first element (2) and the fifth (3). So their max is 3, min 2. Wait, but the note's calculation must be correct. So perhaps the array is different. Let me think of another possibility. Suppose the array is [2, 100, 1, 200, 3, 4]. Then the subsegment l=2 to r=4 (elements 100,1,200). The outside elements are 2, 3,4. Max is 4, min 2. So first part is 2. The subsegment's max is 200, min 1. So total 2+199=201. Not 297. Hmm. Alternatively, maybe the array is [2, 100, 1, 200, 3]. The subsegment is l=1 to r=4. But that's not a proper subsegment because the entire array length is 5, so the subsegment length is 4, which is less than 5. So it's allowed. The outside is the fifth element (3). So the outside's max and min are 3. So first part is 0. The subsegment's max is 200, min 1. So total 0+199=199. Hmm. Alternatively, maybe the subsegment is l=1 to r=3. The outside is the elements 4 and 5 (200 and 3). Max is 200, min 3. So first part is 197. The subsegment's max is 100, min 1. So total 197 + 99 = 296. Close but not 297. Hmm. Alternatively, perhaps the array is [2, 100, 1, 200, 3, 200]. Then the subsegment l=2 to r=4 (elements 100,1,200). The outside includes 2, 200, 3, 200. Max is 200, min 2. So first part is 198. The subsegment's max is 200, min 1. So total 198+199= 397. Not matching. Hmm, perhaps I'm missing something here. Let me re-calculate the note's example. The note says the second test case's optimal subsegment is l=2, r=4. The beauty is (100-2) + (200-1) = 98+199=297. So the first part is 100-2. So the outside's max is 100, min is 2. The outside elements must include 100. But the subsegment includes l=2 (the element 100). So that's impossible. Wait, maybe the subsegment is l=3 to r=4? Then the outside includes the first two elements (2 and 100) and the fifth (3). The max of the outside is 100, min is 2. So first part is 98. The subsegment's elements are 1 and 200. Their max is 200, min 1. So total 98+199=297. That matches. Ah! So the subsegment is l=3 to r=4. Then the outside includes elements before l (elements 1 and 2: 2 and 100) and after r (element 5:3). So the outside's max is 100, min is 2. So the first part is 98. The subsegment's max is 200, min 1. So total 297. So the note's example must have the subsegment l=3 to r=4. But the note says l=2, r=4. So perhaps there's a mistake in the note's description.",
      "start_char": 16264,
      "end_char": 20259,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Well, regardless, the problem requires us to find the maximum over all possible proper subsegments. Back to the approach. The key is to find for each possible subsegment the four values (outside_max, outside_min, inside_max, inside_min).",
      "start_char": 20262,
      "end_char": 20503,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute this efficiently, perhaps precompute prefix and suffix arrays for max and min. \n\nLet me think of the steps:\n\nFor each test case:\n\n1. Read the array a of length n.\n\n2. Precompute prefix_max, prefix_min arrays. prefix_max[i] is the maximum of a[0.. i]\n\nprefix_min[i] is the minimum of a[0..",
      "start_char": 20506,
      "end_char": 20806,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "i]\n\nSimilarly, suffix_max[i] is the maximum of a[i..n-1]\n\nsuffix_min[i] is the minimum of a[i..n-1]\n\nThese can be computed in O(n) time each. Then, for any subsegment from l to r (0-based indices?), the outside elements are the elements before l and after r. The outside_max is the maximum between prefix_max[l-1] (if l>0) and suffix_max[r+1] (if r <n-1). Similarly, the outside_min is the minimum between prefix_min[l-1] and suffix_min[r+1]. The inside_max is the maximum of a[l..r], which can be found using the suffix_max and prefix_max arrays? Or perhaps using the suffix_max array. Wait, the maximum from l to r is the maximum between a[l] to a[r]. To get that quickly, we can precompute a 2D array for range max, but that's O(n^2) space which is not feasible. Alternatively, using the suffix_max array. Wait, the maximum from l to r is the maximum between the suffix_max[l] and the suffix_max[r]? No, that's not correct. Alternatively, the maximum from l to r can be found as the maximum between prefix_max[r] and suffix_max[l]. Wait, no.",
      "start_char": 20806,
      "end_char": 21866,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps the maximum from l to r can be found using a segment tree or a sparse table for range maximum queries. Similarly for the minimum. So, to compute the inside_max and inside_min for any l and r, we can use a range maximum and minimum query. The problem is that for each possible l and r, we need to compute these four values. The total number of possible subsegments is O(n^2), which is way too big for n=1e5. So this approach is not feasible. Hmm, so we need a smarter way.",
      "start_char": 21869,
      "end_char": 22365,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternative Idea: The maximum beauty is the maximum over all possible subsegments of ( (outside_max - outside_min) + (inside_max - inside_min) ). Let me think of the terms:\n\nThe outside_max is the maximum of the elements not in the subsegment. The outside_min is the minimum of the elements not in the subsegment. The inside_max is the maximum of the subsegment. The inside_min is the minimum of the subsegment. The total is (outside_max - outside_min) + (inside_max - inside_min). Hmm, perhaps this can be rewritten as (outside_max + inside_max) - (outside_min + inside_min). Not sure if that helps. Alternatively, note that the outside_max is the maximum between the prefix_max up to l-1 and the suffix_max from r+1. Similarly for the outside_min. The inside_max is the maximum between l and r. The inside_min is the minimum between l and r. \n\nHmm. Another Idea: The maximum possible value of (outside_max - outside_min) is the global_max - global_min. To achieve this, the subsegment must exclude at least one element from the global_max and/or global_min. Wait, no. To have the outside_max be the global_max, the subsegment must not include the element(s) where the global_max occurs.",
      "start_char": 22368,
      "end_char": 23582,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Similarly, to have the outside_min be the global_min, the subsegment must not include the element(s) where the global_min occurs.",
      "start_char": 23583,
      "end_char": 23712,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "So, to have the outside_max - outside_min equal to global_max - global_min, the subsegment must exclude at least one occurrence of the global_max and/or exclude at least one occurrence of the global_min. Wait, no.",
      "start_char": 23715,
      "end_char": 23928,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For example, if the subsegment excludes the global_max, then the outside_max is the global_max. But if it includes the global_min, then the outside_min could still be the global_min.",
      "start_char": 23931,
      "end_char": 24113,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "So, to have the outside_max be the global_max and the outside_min be the global_min, the subsegment must exclude at least one occurrence of the global_max and exclude at least one occurrence of the global_min. Alternatively, the subsegment can exclude either the global_max or the global_min, but not both. Hmm, this is getting too complicated.",
      "start_char": 24116,
      "end_char": 24464,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the maximum possible beauty is (global_max - global_min) plus the maximum possible (inside_max - inside_min) of any subsegment. But in the second example's note, the maximum (inside_max - inside_min) would be 200-1=199. Adding to (global_max - global_min) which is 200-2=198, gives 198+199=397, which is higher than the note's 297. But the note's example's answer is 297. Hmm, so that approach is not correct. Hmm, so maybe the maximum beauty is not simply the sum of the two terms. Alternative Idea: Let's think of the maximum possible value of (outside_max - outside_min) + (inside_max - inside_min).",
      "start_char": 24467,
      "end_char": 25085,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Suppose the subsegment is chosen such that the outside_max is as large as possible and the inside_max is also as large as possible.",
      "start_char": 25088,
      "end_char": 25219,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum between (global_max - global_min) and (max_subsegment's (max - min) + (global_max - global_min)), but I'm not sure.",
      "start_char": 25222,
      "end_char": 25394,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) + (max_sub - min_sub), where the sub is a proper subsegment. Wait, but in the first example, the global_max is 6, global_min is 1. The sub's max is 5, min 1. So 5-1=4. So total is 5 (6-1) +4 =9, which matches the example. In the second example's note, the global_max is 200, global_min is 1 (assuming the array is [2,100,1,200,3]). The subsegment's max is 200, min 1. So their difference is 199. The outside's difference is (100-2) =98. So total is 98+199=297. The global_max - global_min is 200-1=199. So adding the sub's difference (199) would give 398, which is higher than the note's answer. But that's not possible because the outside's difference is 98. Hmm, so the approach of adding the two terms is not correct.",
      "start_char": 25397,
      "end_char": 26201,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, so perhaps the maximum beauty is the maximum over all possible subsegments of (outside_max - outside_min) + (inside_max - inside_min).",
      "start_char": 26204,
      "end_char": 26343,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute this efficiently, perhaps we can find for each possible position where the subsegment ends or starts, but I'm not sure.",
      "start_char": 26346,
      "end_char": 26476,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternative Idea: Let's consider that the maximum beauty can be obtained by choosing a subsegment that excludes either the global_max or the global_min. Wait, but how?",
      "start_char": 26479,
      "end_char": 26646,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, the maximum beauty is the maximum between (global_max - some_min) + (some_max - some_min_sub), but I'm not sure.",
      "start_char": 26651,
      "end_char": 26778,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, perhaps the key is to realize that the maximum possible beauty is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any subsegment that excludes the global_max or the global_min.",
      "start_char": 26781,
      "end_char": 27006,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments.",
      "start_char": 27009,
      "end_char": 27154,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute this efficiently, perhaps we can precompute for all possible subsegments the four values, but that's O(n^2), which is not feasible.",
      "start_char": 27157,
      "end_char": 27299,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps the maximum beauty is the maximum of (max_a - min_a) plus (max_sub - min_sub), but only when the subsegment excludes at least one element. Wait, but the first term (max_a - min_a) is the global difference.",
      "start_char": 27302,
      "end_char": 27522,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The second term is the sub's difference. But the outside's difference would be less than or equal to the global difference. Hmm, this is really tricky. Alternative Idea: Let's think of the maximum possible value of (outside_max - outside_min) + (inside_max - inside_min). This can be rewritten as (outside_max + inside_max) - (outside_min + inside_min).",
      "start_char": 27523,
      "end_char": 27882,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps we can find the maximum of (outside_max + inside_max) and the minimum of (outside_min + inside_min). But I'm not sure. Alternatively, perhaps the maximum is achieved when the subsegment is the entire array except one element.",
      "start_char": 27885,
      "end_char": 28127,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Because then the outside is just that one element, so outside_max and outside_min are the same (the element itself), so their difference is zero. The inside is the rest, so the inside's difference is (max_inside - min_inside).",
      "start_char": 28130,
      "end_char": 28356,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, the maximum could be when the subsegment is the entire array except the first element. Then the outside is the first element, so difference zero. The inside's difference is (max of the rest - min of the rest). Similarly for excluding the last element.",
      "start_char": 28359,
      "end_char": 28627,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, the maximum could be when the subsegment is the entire array except the global_max. Then the outside's max is the global_max, and the outside's min is the global_min (if the subsegment excludes the global_max but includes the global_min). Hmm, this is getting too vague.",
      "start_char": 28630,
      "end_char": 28917,
      "label": "test_generation",
      "label_info": {
        "type": "test_generation"
      }
    },
    {
      "text": "Perhaps the correct approach is to precompute for all possible subsegments the four values using prefix and suffix arrays and range max/min queries, but find a way to do this in O(n) or O(n log n) time. Let me think of the steps again. First, precompute prefix_max, prefix_min, suffix_max, suffix_min arrays.",
      "start_char": 28920,
      "end_char": 29232,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Then, for any subsegment [l, r], the outside_max is the maximum between prefix_max[l-1] (if l>0) and suffix_max[r+1] (if r <n-1). Similarly, outside_min is the minimum between prefix_min[l-1] and suffix_min[r+1]. The inside_max is the maximum of a[l..r], which can be found using a range max query. The inside_min is the minimum of a[l..r], using a range min query.",
      "start_char": 29235,
      "end_char": 29606,
      "label": "code_analysis",
      "label_info": {
        "type": "code_analysis"
      }
    },
    {
      "text": "The problem is to find the maximum of (outside_max - outside_min) + (inside_max - inside_min) over all possible l and r where the subsegment is proper (i.e., not the entire array). The key is to find this maximum efficiently. The range max and min queries can be done in O(1) per query with a sparse table. The sparse table can be built in O(n log n) time. So the steps would be: For each test case:\n\n1. Read the array a. \n\n2. Precompute prefix_max, prefix_min, suffix_max, suffix_min arrays. 3. Build a sparse table for range max and min queries. 4. Iterate over all possible l and r (but this is O(n^2), which is too slow for n=1e5). Hmm, so this approach is not feasible.",
      "start_char": 29609,
      "end_char": 30298,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps there's a way to find the maximum without iterating all possible l and r. \n\nLet me think of the terms again. The expression is (outside_max - outside_min) + (inside_max - inside_min).",
      "start_char": 30301,
      "end_char": 30499,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Let me see if this can be rewritten as (outside_max + inside_max) - (outside_min + inside_min). Yes. So the goal is to maximize this expression.",
      "start_char": 30502,
      "end_char": 30646,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps the maximum occurs when outside_max + inside_max is as large as possible and outside_min + inside_min is as small as possible. But how to find this? Alternatively, perhaps the maximum is achieved when the subsegment is the entire array except one element. Let me see.",
      "start_char": 30653,
      "end_char": 30937,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Suppose the subsegment is the entire array except the first element. Then the outside is the first element. So outside_max and outside_min are a[0]. Their difference is zero. The inside is the rest of the array. The inside's max and min are the global max and min (excluding a[0]). Wait, but the global max could be in the inside. Hmm, but in this case, the total would be (0) + (max_inside - min_inside).",
      "start_char": 30942,
      "end_char": 31351,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, if the subsegment excludes the first element, then the inside's max could be the global max (if it's not the first element). Hmm, but this might not be the maximum.",
      "start_char": 31354,
      "end_char": 31535,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum is achieved when the subsegment is the entire array except the first element or the last element. Let me test this with the first example. First example's array is [1,2,3,4,5,6,1,5]. The optimal subsegment is l=7, r=8 (assuming 1-based, so 0-based indices 6 and 7). The outside is the first 6 elements (indices 0-5). Their max is 6, min is 1. So their difference is 5. The inside is [1,5], max 5, min 1. So total 5+4=9. If we take the subsegment excluding the first element (indices 1-7), then the outside is a[0]=1. The inside's max is 6, min 1. So the total is (0) + (6-1) =5, which is less than 9. So the maximum is not achieved in this case. Hmm.",
      "start_char": 31538,
      "end_char": 32229,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Another Idea: The maximum beauty can be obtained by choosing a subsegment that excludes either the global_max or the global_min. \n\nSuppose the subsegment excludes the global_max. Then the outside_max is the global_max. The outside_min could be the global_min (if the subsegment includes it). The inside's max would be the maximum of the subsegment, which could be less than the global_max. Hmm, but this might not be better than other options.",
      "start_char": 32236,
      "end_char": 32683,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any subsegment that excludes the global_max or the global_min. But how to compute this efficiently?",
      "start_char": 32686,
      "end_char": 32915,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, the maximum beauty is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any subsegment that excludes the global_max, and similarly for excluding the global_min. But how to compute the maximum (inside_max - inside_min) for subsegments that exclude the global_max?",
      "start_char": 32920,
      "end_char": 33239,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps the maximum (inside_max - inside_min) over all possible subsegments is the same as the global_max - global_min. But that can't be, because the subsegment can't be the entire array.",
      "start_char": 33244,
      "end_char": 33437,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, the maximum (inside_max - inside_min) for any proper subsegment would be the global_max - global_min if there exists a proper subsegment that includes both the global_max and global_min. Otherwise, it would be the maximum between (global_max - some_min) or (some_max - global_min). Hmm, this is getting too involved.",
      "start_char": 33440,
      "end_char": 33766,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the correct approach is to realize that the maximum beauty is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any proper subsegment, and the maximum (outside_max - outside_min) plus (inside_max - inside_min) for other cases. But I'm not sure.",
      "start_char": 33769,
      "end_char": 34063,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is simply the maximum between (global_max - global_min) and the maximum (inside_max - inside_min) of any proper subsegment plus the (outside_max - outside_min) for that subsegment. But how to find this maximum efficiently. Hmm, perhaps the maximum is achieved when the subsegment is the entire array except one element. Let me see for the first example. The first example's array is [1,2,3,4,5,6,1,5]. The maximum when excluding the first element (so subsegment is 2-8) gives outside_max=1 (the first element), so outside difference is 0. The inside's max is 6, min 1. So total 0+5=5.",
      "start_char": 34068,
      "end_char": 34702,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The optimal subsegment in the example is when excluding the last two elements (the subsegment is up to 6?), but I'm not sure.",
      "start_char": 34705,
      "end_char": 34830,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, the maximum is achieved when the subsegment is such that the outside includes the global_max and global_min, and the inside has a large difference.",
      "start_char": 34833,
      "end_char": 34995,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, perhaps the maximum beauty is the global_max - global_min plus the maximum (inside_max - inside_min) of any subsegment that doesn't include the global_max or global_min. But I'm not sure. This is really challenging. Perhaps I should look for a different approach. Let me think of the problem differently. The beauty is (max_outside - min_outside) + (max_inside - min_inside). This can be rewritten as (max_outside + max_inside) - (min_outside + min_inside). To maximize this, we need to maximize (max_outside + max_inside) and minimize (min_outside + min_inside). Hmm, but how?",
      "start_char": 34998,
      "end_char": 35594,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, the maximum possible value of (max_outside + max_inside) is the global_max + global_max (if the subsegment includes the global_max and the outside also includes it). But that's not possible because the subsegment and outside are complementary.",
      "start_char": 35599,
      "end_char": 35857,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, the outside and inside are complementary. So if the subsegment includes the global_max, then the outside does not. So the max_outside can be at most the second highest value. Hmm, this is getting too complicated.",
      "start_char": 35860,
      "end_char": 36080,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Perhaps the correct approach is to precompute for all possible subsegments the four values using the prefix/suffix arrays and range queries, but find a way to do this in O(n) time.",
      "start_char": 36083,
      "end_char": 36263,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Wait, perhaps the maximum beauty is the maximum between (global_max - global_min) and the maximum (inside_max - inside_min) plus the maximum (outside_max - outside_min) for that subsegment. But I'm not sure.",
      "start_char": 36266,
      "end_char": 36473,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) for any proper subsegment.",
      "start_char": 36478,
      "end_char": 36617,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Wait, but in the first example, the global difference is 5 (6-1), and the sub's difference is 4 (5-1). So total 9, which matches. In the second example's note, the global difference is 200-1=199. The sub's difference is 200-1=199. So total 199+199=398, but the note's answer is 297. So this approach is incorrect. Hmm, so that approach is wrong.",
      "start_char": 36620,
      "end_char": 36969,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Hmm, perhaps the maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments.",
      "start_char": 36972,
      "end_char": 37107,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute this efficiently, perhaps we can find for each possible position the best possible subsegment ending or starting there. Alternatively, perhaps the maximum is achieved when the subsegment is the entire array except one element. Let me see for the second example's note. The array is [2,100,1,200,3]. The global_max is 200, global_min is 1. If the subsegment is the entire array except the first element (indices 1-4), then the outside is 2. The outside's difference is 0. The inside's max is 200, min 1. So total 0+199=199. If the subsegment is the entire array except the second element (indices 0,2-4), then the outside is 100. The outside's difference is 0. The inside's max is 200, min 1. So total 0+199=199. If the subsegment is the entire array except the third element (indices 0-1 and 3-4), then the outside is 1. The outside's difference is 0. The inside's max is 200, min 2. So difference 198. Total 198. If the subsegment is the entire array except the fourth element (indices 0-3), then the outside is 3. The inside's max is 200, min 1. So total 0+199=199.",
      "start_char": 37110,
      "end_char": 38202,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "If the subsegment is the entire array except the fifth element (indices 0-3), then the outside is 3. \n\nHmm, but the note's example's answer is 297. So this approach is not yielding that. Hmm, so the maximum must be achieved by a subsegment that is not the entire array minus one element. In the note's example, the subsegment is l=3 to r=4 (0-based indices 2 and 3?), giving the outside elements 2,100,3. Their max is 100, min is 2. So difference 98. The inside's max is 200, min 1. So total 98+199=297. So this subsegment is of length 2. Hmm, so the maximum can be achieved by a small subsegment.",
      "start_char": 38205,
      "end_char": 38810,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "This suggests that we need to consider all possible subsegments, but it's computationally impossible for large n. \n\nHmm, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) of any subsegment that does not include the global_max or global_min. But I'm not sure.",
      "start_char": 38813,
      "end_char": 39119,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum between (max_a - min_a) and the maximum (max_sub - min_sub) plus the maximum (max_outside - min_outside) for that subsegment. But I'm stuck. Perhaps I should look for a different approach. Let me think of the following: \n\nThe beauty is (max_outside - min_outside) + (max_inside - min_inside). The outside and inside are complementary.",
      "start_char": 39124,
      "end_char": 39523,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The maximum possible value of this expression is the maximum over all possible splits of the array into two parts (the inside and outside). The maximum can be found by considering all possible splits where the inside is a proper subsegment. To compute this efficiently, perhaps we can precompute for each position the maximum and minimum to the left and right.",
      "start_char": 39526,
      "end_char": 39890,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Wait, perhaps the maximum beauty is the maximum of (max_left - min_left) + (max_right - min_right), where the array is split into left and right parts. But the split can be anywhere.",
      "start_char": 39893,
      "end_char": 40075,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Wait, for any split point between index i and i+1, the left part is up to i, the right part starts at i+1. But the subsegment can be any subsegment, not just a split into two parts. Hmm, but perhaps the maximum is achieved when the subsegment is a single element. For example, if the subsegment is a single element x, then the outside is the rest of the array. The outside's max and min are the global max and min excluding x. The inside's max and min are x. So the beauty is (max_outside - min_outside) + (x - x) = max_outside - min_outside. So the maximum beauty in this case would be the maximum of (max_outside - min_outside) for any single element excluded. This could be a candidate for the maximum.",
      "start_char": 40080,
      "end_char": 40797,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Similarly, the maximum could be achieved by excluding a single element. So perhaps the maximum beauty is the maximum between the following candidates:\n\n1. The maximum (max_outside - min_outside) when excluding any single element. 2. The maximum (max_inside - min_inside) when the subsegment is the entire array except one element. 3. The global_max - global_min plus the maximum (max_inside - min_inside) of any proper subsegment. But I'm not sure.",
      "start_char": 40800,
      "end_char": 41254,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, the maximum beauty is the maximum between:\n\n- The maximum (max_outside - min_outside) for any single element excluded. - The maximum (max_inside - min_inside) for any single element excluded.",
      "start_char": 41259,
      "end_char": 41467,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "- The maximum (max_outside - min_outside) + (max_inside - min_inside) for any subsegment of length 2. But this is still not clear. Hmm, perhaps the optimal subsegment is either a single element or a pair of elements. But I'm not sure.",
      "start_char": 41470,
      "end_char": 41708,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum between the following:\n\nFor each element a[i], compute the beauty when the subsegment is the entire array except a[i]. The beauty would be (max of the rest - min of the rest) + (max of the rest - min of the rest) ? No, wait, the inside is the rest except a[i], so the outside is a[i]. Wait, no.",
      "start_char": 41713,
      "end_char": 42066,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "If the subsegment is the entire array except a[i], then the outside is a[i]. So the outside's max and min are a[i]. So their difference is zero.",
      "start_char": 42069,
      "end_char": 42213,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The inside is the rest of the array. So the inside's max and min are the global max and min excluding a[i]. So the beauty is (0) + (max_inside - min_inside). The maximum of this over all a[i] is a candidate.",
      "start_char": 42214,
      "end_char": 42425,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Another candidate is when the subsegment is the entire array except two elements. But this is getting too time-consuming.",
      "start_char": 42428,
      "end_char": 42549,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Perhaps the correct approach is to precompute for each position the maximum and minimum to the left and right, and then compute the maximum for all possible subsegments of length 1 or 2. But I'm not sure.",
      "start_char": 42554,
      "end_char": 42758,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) of any proper subsegment. But in the second example's note, this would give 199 + 199 = 398, but the correct answer is 297. So this is not correct. Hmm, I'm stuck. Perhaps I should look for hints in the problem's constraints. The problem's constraints are n up to 1e5 and t up to 1e3. So the solution must be O(n) or O(n log n) per test case. The first program's code is to be filled in. The current code has a loop over test cases, and inside, the code is missing. The code needs to read n and the array, then compute the maximum beauty.",
      "start_char": 42763,
      "end_char": 43426,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the solution is to realize that the maximum beauty is the maximum between (max_a - min_a) and the maximum (max_sub - min_sub) for any proper subsegment. Wait, but in the first example, the global difference is 5, and the sub's difference is 4. So total 5+4=9. In the second example's note, the global difference is 199, the sub's difference is 199. So total 199+199=398, but the correct answer is 297. So this approach is wrong. Hmm.",
      "start_char": 43429,
      "end_char": 43874,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Another Idea: The maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments.",
      "start_char": 43881,
      "end_char": 44017,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute this efficiently, perhaps the maximum is achieved when the subsegment is the entire array except the first or last element. But in the first example, excluding the first element gives a beauty of 5 (inside's difference is 5). The optimal is 9, which is higher. Hmm. Perhaps the maximum is achieved when the subsegment is the entire array except the first and last elements. In the first example, excluding first and last elements gives a subsegment of length 6.",
      "start_char": 44020,
      "end_char": 44502,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The outside is the first and last elements (1 and 5). Their max is 5, min 1. So difference 4. The inside's max is 6, min 1. So total 4+5=9. Which matches the example. Ah! So this is the case. The subsegment is the entire array except the first and last elements.",
      "start_char": 44503,
      "end_char": 44769,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The outside is the first and last elements. So the maximum beauty could be achieved by excluding the first and last elements. Hmm, but how to generalize this.",
      "start_char": 44772,
      "end_char": 44934,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the maximum beauty is the maximum of (max of first and last elements) - (min of first and last elements) plus the maximum of the inside's max and min",
      "start_char": 44937,
      "end_char": 45094,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": ". \n\nWait, in the first example, the first and last elements are 1 and 5. Their max is 5, min 1. So difference 4. The inside's max is 6, min 1. So total 4+5=9. In the second example's note, the first and last elements are 2 and 3. Their max is 3, min 2. So difference 1. The inside's max is 200, min 1. So total 1+199=200. But the note's answer is 297. Hmm, so this approach also doesn't work. Hmm, I'm really stuck. Perhaps I should look for the solution's approach elsewhere. Wait, the problem's beauty is the difference between the outside's max and min plus the inside's max and min.",
      "start_char": 45094,
      "end_char": 45690,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The maximum possible value of this is when the outside's max and min are as large as possible and the inside's max and min are also as large as possible.",
      "start_char": 45693,
      "end_char": 45846,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the optimal subsegment is such that the outside contains the global max and the inside contains the global min, or vice versa.",
      "start_char": 45849,
      "end_char": 45983,
      "label": "test_generation",
      "label_info": {
        "type": "test_generation"
      }
    },
    {
      "text": "Alternatively, the maximum beauty is the global_max - global_min plus the maximum possible (inside_max - inside_min) for any subsegment that includes the global_max and global_min. But I'm not sure.",
      "start_char": 45986,
      "end_char": 46184,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, the maximum beauty is the maximum between (max_a - min_a) and the maximum (max_sub - min_sub) for any proper subsegment plus the (max_outside - min_outside) for that subsegment. But how to compute this efficiently.",
      "start_char": 46189,
      "end_char": 46418,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the solution is to realize that the maximum beauty is the maximum between the global_max - global_min and the maximum (max_sub - min_sub) for any proper subsegment plus the (max_outside - min_outside) for that subsegment. But I'm not sure.",
      "start_char": 46423,
      "end_char": 46670,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) for any proper subsegment that does not include the global_max or global_min. But I'm not sure.",
      "start_char": 46675,
      "end_char": 46883,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Hmm, perhaps the correct approach is to precompute for each position the maximum and minimum to the left and right, and then compute the maximum for all possible subsegments of length 1 or 2. But I'm not sure.",
      "start_char": 46888,
      "end_char": 47097,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) for any proper subsegment. But this doesn't work for the second example. Hmm. Perhaps I should look for the solution's code structure. The first program's code is a loop over test cases. Inside, we need to read n and the array. The code needs to compute the maximum beauty. The code must be O(n) or O(n log n) per test case.",
      "start_char": 47102,
      "end_char": 47551,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Perhaps the solution is to realize that the maximum beauty is the maximum between the global_max - global_min and the maximum (max_sub - min_sub) for any proper subsegment. But in the second example's note, the global_max - global_min is 199, and the maximum sub's difference is 199 (the sub that includes the global_max and global_min). But the outside's difference would be 98, so the total is 297. So the maximum beauty is not simply the sum of the two terms. Hmm.",
      "start_char": 47554,
      "end_char": 48021,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Perhaps the solution is to compute for each possible subsegment the outside's max and min using the prefix and suffix arrays, and the inside's max and min using a sparse table.",
      "start_char": 48030,
      "end_char": 48206,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Then, iterate over all possible subsegments of length 1, 2, or n-1, since those are the only candidates for maximum. But I'm not sure.",
      "start_char": 48209,
      "end_char": 48343,
      "label": "test_generation",
      "label_info": {
        "type": "test_generation"
      }
    },
    {
      "text": "Alternatively, the maximum beauty is achieved when the subsegment is the entire array except the first element or the last element. In the first example, excluding the first element gives a beauty of 5 (inside's difference is 5). Excluding the last element gives a beauty of (6-1) + (5-1) =5+4=9. Ah! So excluding the last element gives the correct answer. The outside is the first element and the last element (since the subsegment is the first n-1 elements). Wait, the subsegment is the first n-1 elements.",
      "start_char": 48348,
      "end_char": 48864,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The outside is the last element. So the outside's max and min are the last element. So their difference is zero. The inside's max is 6, min 1. So total 0+5=5. Hmm, no. Wait, the first example's array is [1,2,3,4,5,6,1,5]. The last element is 5.",
      "start_char": 48865,
      "end_char": 49113,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "If the subsegment is the first 7 elements (indices 0-6), then the outside is the last element (5). So outside's max and min are 5. Their difference is zero. The inside's max is 6, min 1. So total 0+5=5. But the optimal subsegment is the first 7 elements excluding the last element? Hmm, I'm confused. Perhaps the optimal subsegment is the last two elements (indices 6 and 7). The outside is the first 6 elements. Their max is 6, min 1. So difference 5. The inside's max is 5, min 1. So total 5+4=9. Ah! So this is a subsegment of length 2. So the maximum beauty can be achieved by a small subsegment. This suggests that the maximum is achieved by a subsegment of length 2.",
      "start_char": 49116,
      "end_char": 49800,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Perhaps the maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments of length 2. This would be O(n) time.",
      "start_char": 49803,
      "end_char": 49970,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Let me see: \n\nFor each possible subsegment of length 2 (i and i+1), compute the outside's max and min, and the inside's max and min. The inside's max and min are the two elements. The outside is the rest of the array. The outside's max is the maximum of the entire array except the two elements. The outside's min is the minimum of the entire array except the two elements. The maximum of this over all pairs would give the maximum beauty. But how to compute this efficiently. The global_max and global_min can be precomputed.",
      "start_char": 49975,
      "end_char": 50515,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "For each pair of elements a[i], a[i+1], the outside's max is the global_max if it is not in the pair. Similarly for the min. So for each pair, the outside's max is max(global_max excluding a[i] and a[i+1]). Wait, but this requires knowing whether the global_max is in the pair. Hmm, this might be manageable. Let me think: \n\nCompute global_max and global_min.",
      "start_char": 50518,
      "end_char": 50885,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "For each pair of elements a[i], a[i+1], the outside's max is:\n\nif global_max is not in the pair, then it's global_max. \n\nelse, it's the second highest value in the array.",
      "start_char": 50888,
      "end_char": 51058,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Similarly for the outside's min. But this requires precomputing the second highest and second lowest values. This could be done.",
      "start_char": 51061,
      "end_char": 51189,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Then, for each pair, the outside's max is:\n\nif the pair contains the global_max, then the second_max. \n\nelse, global_max. Similarly for the min. The inside's max and min are max(a[i], a[i+1]) and min(a[i], a[i+1]). The beauty for this pair is (outside_max - outside_min) + (inside_max - inside_min). The maximum of this over all pairs would be a candidate for the maximum beauty. Additionally, we need to consider subsegments of length 1 and length n-1. For a subsegment of length 1 (a[i]), the outside's max and min are the global_max and global_min excluding a[i]. The inside's max and min are a[i]. The beauty is (outside_max - outside_min) + 0. The maximum of this over all single elements is another candidate. Similarly for subsegments of length n-1. This approach would be O(n) time per test case. This seems feasible. Let me see for the first example: The global_max is 6, global_min is 1. The second_max is 5 (the next highest after 6). The second_min is 1 (since the global_min is 1, and there are other 1's). For the pair (1,5) (the last two elements), the outside's max is 6 (since the pair doesn't contain 6).",
      "start_char": 51196,
      "end_char": 52352,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The outside's min is 1 (since the pair contains one of the 1's, but there are others). So outside_max - outside_min is 5. The inside's max is 5, min 1. So total 5+4=9. Which matches the example. For the second example's note: The array is [2,100,1,200,3]. Global_max is 200, global_min is 1. Second_max is 100. Second_min is 2. The optimal subsegment is the pair (100,1) and (200,3) ? Wait, the optimal subsegment is indices 2 and 3 (1 and 200). The outside elements are 2, 100, 3. The outside's max is max(2,100,3) =100. The outside's min is min(2,100,3) =2. So outside difference is 98. The inside's max is 200, min 1. Total 98+199=297.",
      "start_char": 52353,
      "end_char": 53021,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For this pair (indices 2 and 3), the pair contains 200 (the global_max) and 1 (the global_min). So the outside's max is the second_max (100), since the pair contains the global_max. The outside's min is the second_min (2), since the pair contains the global_min (1). So outside_max - outside_min is 100-2=98. The inside's max is 200, min 1. Total 297. This approach would capture this case. So the steps are: For each test case:\n\n1. Compute global_max and global_min. 2. Compute second_max and second_min. 3. Compute the maximum beauty from subsegments of length 1, 2, and n-1. 4. The maximum among all these is the answer. Wait, but what about longer subsegments?",
      "start_char": 53024,
      "end_char": 53711,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For example, a subsegment of length 3 might give a higher value. But perhaps the maximum is achieved by a subsegment of length 1, 2, or n-1. Alternatively, the maximum is among all possible subsegments of length 1, 2, or the entire array except one element. This would reduce the computation to O(n) time. So the plan is: Compute the maximum beauty among all possible subsegments of length 1, 2, or n-1. This would be feasible. Let me see for the first example's optimal subsegment (length 2), it is captured. For the second example's optimal subsegment (length 2), it is captured.",
      "start_char": 53714,
      "end_char": 54310,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Another example: if the optimal subsegment is of length 3, but the maximum is captured by a shorter subsegment. But perhaps this approach works. So the steps are:",
      "start_char": 54313,
      "end_char": 54475,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "For each test case:\n\n- Compute global_max and global_min. \n\n- Compute second_max and second_min. \n\n- Compute the maximum beauty for subsegments of length 1, 2, and n-1. - The maximum among these is the answer. Wait, but what about subsegments of length n-1? For example, the subsegment of length n-1 (excluding one element) would have outside as that one element. The outside's max and min are the element itself. So their difference is zero.",
      "start_char": 54481,
      "end_char": 54931,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The inside's max and min are the global_max and global_min excluding that element. So the beauty is (0) + (max_inside - min_inside). The maximum of this over all elements is a candidate. So the steps are: Compute the following candidates:\n\n1. For all single elements (subsegments of length n-1):\n\n   The beauty is (0) + (max_inside - min_inside). The max_inside is the global_max excluding the excluded element.",
      "start_char": 54934,
      "end_char": 55357,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The min_inside is the global_min excluding the excluded element. So for each element a[i], compute the max and min of the array excluding a[i]. The maximum of (max - min) over all a[i] is a candidate. 2.",
      "start_char": 55363,
      "end_char": 55576,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "For all pairs of elements (subsegments of length 2):\n\n   The beauty is (outside_max - outside_min) + (max(a[i],a[i+1]) - min(a[i],a[i+1])).",
      "start_char": 55579,
      "end_char": 55718,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "To compute outside_max and outside_min:\n\n   - outside_max is global_max if the pair doesn't contain global_max, else second_max.",
      "start_char": 55724,
      "end_char": 55852,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "- outside_min is global_min if the pair doesn't contain global_min, else second_min. So for each pair, compute this and track the maximum. \n\n3. For subsegments of length n-1 (excluding one element):\n\n   The beauty is (max_inside - min_inside). Which is the same as the first candidate. So the first and third candidates are the same.",
      "start_char": 55858,
      "end_char": 56201,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Thus, the maximum beauty is the maximum between the first candidate (max of (max_inside - min_inside) for excluding any single element) and the second candidate (max of the pair's beauty).",
      "start_char": 56206,
      "end_char": 56394,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Additionally, we need to consider the case where the subsegment is the entire array except two elements. But this might be too time-consuming. Alternatively, the maximum is the maximum between the first and second candidates.",
      "start_char": 56397,
      "end_char": 56626,
      "label": "test_generation",
      "label_info": {
        "type": "test_generation"
      }
    },
    {
      "text": "Let me see for the first example:\n\nThe first candidate (max of (max_inside - min_inside) for excluding any single element):\n\nFor example, excluding the last element (5), the inside's max is 6, min 1. So difference 5. Excluding the first element (1), the inside's max is 6, min 1. So difference 5. Excluding the element 6 (the global_max), the inside's max is 5, min 1. So difference 4. The maximum among these is 5. The second candidate (pairs) gives 9. So the maximum is 9.",
      "start_char": 56629,
      "end_char": 57111,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For the second example's note:\n\nThe first candidate's maximum is 199 (excluding the 1, the inside's max is 200, min 2. So difference 198. Excluding the 200, the inside's max is 100, min 1. So difference 99. Excluding the 1, the inside's max is 200, min 2. So difference 198. The maximum is 198. The second candidate's maximum is 297 (the pair of 1 and 200). So the maximum is 297. This approach works for these examples. Thus, the solution is to compute the maximum between the two candidates. Now, how to compute the first candidate efficiently. The first candidate requires for each element a[i], the maximum and minimum of the array excluding a[i]. This can be done with prefix and suffix arrays.",
      "start_char": 57116,
      "end_char": 57829,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For each position i, the max excluding a[i] is the maximum between the prefix_max[i-1] and suffix_max[i+1]. Similarly for the min. Thus, for each i in 0..n-1:\n\nmax_without_i = max( prefix_max[i-1], suffix_max[i+1] ) min_without_i = min( prefix_min[i-1], suffix_min[i+1] ) The difference is max_without_i - min_without_i. The maximum of these is the first candidate. The second candidate requires for each pair of consecutive elements (i and i+1):\n\ncompute outside_max and outside_min.",
      "start_char": 57832,
      "end_char": 58326,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "To compute outside_max:\n\nif the pair contains the global_max, then outside_max is the second_max. Else, it's global_max. Similarly for outside_min. But how to compute second_max and second_min? We can precompute the second_max and second_min.",
      "start_char": 58329,
      "end_char": 58579,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "Alternatively, for each pair, we can compute whether the pair contains the global_max or global_min. But this might be time-consuming. Alternatively, we can precompute the second_max and second_min. To compute second_max:\n\n- Find the maximum element, then find the second maximum. This can be done in O(n) time. Similarly for second_min. Once we have global_max, second_max, global_min, second_min, then for each pair:\n\nif a[i] == global_max or a[i+1] == global_max:\n\n   outside_max = second_max \n\nelse:\n\n   outside_max = global_max \n\nSimilarly for outside_min. But this is only true if the global_max is not in the pair. Wait, no.",
      "start_char": 58582,
      "end_char": 59225,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "The outside_max is the maximum of the array excluding the two elements in the pair. So if the pair contains the global_max, then the outside_max is the second_max. Otherwise, it's the global_max. Similarly for the min. Thus, for each pair (i, i+1):\n\noutside_max = global_max \n\nif either a[i] or a[i+1] is global_max:\n\n   outside_max = second_max \n\nif both are global_max (but that's possible only if there are multiple global_max elements), then the outside_max is the second_max. Similarly for the min. Thus, the steps are: For each test case:\n\n1. Read the array a. \n\n2. Compute global_max = max(a), global_min = min(a). 3. Compute second_max: the second highest value in the array. To compute this:\n\n   - Iterate through the array, track the first and second maximum. Similarly for second_min. \n\n4. Precompute prefix_max, prefix_min, suffix_max, suffix_min arrays. 5. Compute the first candidate: the maximum of (max_without_i - min_without_i) for all i. This requires for each i:\n\n   max_without_i = max( prefix_max[i-1], suffix_max[i+1] )\n\n   min_without_i = min( prefix_min[i-1], suffix_min[i+1] )\n\n   compute the difference and track the maximum. \n\n6. Compute the second candidate: the maximum over all pairs (i, i+1) of:\n\n   outside_max = global_max \n\n   if a[i] == global_max or a[i+1] == global_max:\n\n       outside_max = second_max \n\n   outside_min = global_min \n\n   if a[i] == global_min or a[i+1] == global_min:\n\n       outside_min = second_min \n\n   inside_max = max(a[i], a[i+1])\n\n   inside_min = min(a[i], a[i+1])\n\n   beauty = (outside_max - outside_min) + (inside_max - inside_min)\n\n   track the maximum of this. 7. The answer is the maximum between the first and second candidates. This approach should work and be O(n) per test case. Now, implementing this in code. For program1.py:\n\nThe code needs to read n and the array.",
      "start_char": 59232,
      "end_char": 61112,
      "label": "high_level_plan",
      "label_info": {
        "type": "high_level_plan"
      }
    },
    {
      "text": "First, compute the prefix and suffix arrays. Then compute global_max, global_min, second_max, second_min. Then compute the first candidate. Then compute the second candidate. Finally, output the maximum of the two. Now, let's write the code. The code outline:\n\nfor _ in range(int(input())):\n    n = int(input())\n    a = list(map(int, input().split())) if n ==1:\n        # but according to input constraints, n>=4. So no need. # compute global_max and global_min\n    global_max = max(a) global_min = min(a)\n    # compute second_max and second_min\n    # for second_max:\n    first_max = -inf\n    second_max = -inf\n    for num in a:\n        if num > first_max:\n            second_max = first_max\n            first_max = num\n        elif num > second_max:\n            second_max = num\n    # similarly for second_min:\n    first_min = inf\n    second_min = inf\n    for num in a:\n        if num < first_min:\n            second_min = first_min\n            first_min = num\n        elif num < second_min:\n            second_min = num\n    # compute prefix_max, prefix_min\n    prefix_max = [0]*n\n    prefix_min = [0]*n\n    prefix_max[0] = a[0]\n    prefix_min[0] = a[0]\n    for i in range(1, n):\n        prefix_max[i] = max(prefix_max[i-1], a[i])\n        prefix_min[i] = min(prefix_min[i-1], a[i])\n    # compute suffix_max, suffix_min\n    suffix_max = [0]*n\n    suffix_min = [0]*n\n    suffix_max[-1] = a[-1]\n    suffix_min[-1] = a[-1]\n    for i in range(n-2, -1, -1):\n        suffix_max[i] = max(suffix_max[i+1], a[i])\n        suffix_min[i] = min(suffix_min[i+1], a[i])\n    # compute first candidate: max of (max_without_i - min_without_i)\n    first_candidate = 0\n    for i in range(n):\n        # compute max_without_i\n        left_max = prefix_max[i-1] if i>0 else -inf\n        right_max = suffix_max[i+1] if i <n-1 else -inf\n        if left_max == -inf and right_max == -inf:\n            # this can't happen since n>=4 and i is one element\n            pass\n        else:\n            max_without = max(left_max, right_max)\n        # similarly for min_without\n        left_min = prefix_min[i-1] if i>0 else inf\n        right_min = suffix_min[i+1] if i <n-1 else inf\n        min_without = min(left_min, right_min)\n        current_diff = max_without - min_without\n        if current_diff > first_candidate: first_candidate = current_diff\n    # compute second candidate: max over pairs\n    second_candidate = 0\n    for i in range(n-1):\n        a_i = a[i]\n        a_j = a[i+1]\n        # compute outside_max\n        if a_i == global_max or a_j == global_max:\n            outside_max = second_max\n        else:\n            outside_max = global_max\n        # compute outside_min\n        if a_i == global_min or a_j == global_min:\n            outside_min = second_min\n        else:\n            outside_min = global_min\n        inside_max = max(a_i, a_j) inside_min = min(a_i, a_j)\n        current_beauty = (outside_max - outside_min) + (inside_max - inside_min)\n        if current_beauty > second_candidate:\n            second_candidate = current_beauty\n    # also consider the case where the subsegment is the entire array except two elements? # but perhaps the second candidate covers this. # the maximum between first and second candidates\n    ans = max(first_candidate, second_candidate)\n    print(ans) Wait, but what about the case where the subsegment is longer than 2?",
      "start_char": 61115,
      "end_char": 64523,
      "label": "code_analysis",
      "label_info": {
        "type": "code_analysis"
      }
    },
    {
      "text": "For example, a subsegment of length 3 might give a higher value. But according to the examples, the maximum is achieved by a subsegment of length 2. Perhaps this approach works. Now, let's test this code with the first example. First example's array: [1,2,3,4,5,6,1,5]. global_max is 6, global_min is 1. second_max is 5 (the next highest after 6). second_min is 1 (since there are multiple 1's).",
      "start_char": 64526,
      "end_char": 64935,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "For the pair (1,5) (indices 6 and 7):\n\noutside_max: since the pair contains 5 (not the global_max 6), so outside_max is 6. outside_min: the pair contains 1 (the global_min), so outside_min is second_min (1). Wait, the second_min is 1 because there are multiple 1's. So outside_min is second_min, which is 1. So outside_max - outside_min is 6-1=5. Inside_max is 5, inside_min is 1. Total 5+4=9. Which is correct. For the second example's note:\n\narray [2,100,1,200,3]. global_max is 200, global_min is 1. \n\nsecond_max is 100. second_min is 2. The pair (100,1) (indices 1 and 2):\n\noutside_max: the pair contains 100 and 1. The global_max is 200, which is not in the pair. So outside_max is 200. outside_min: the pair contains the global_min (1), so outside_min is second_min (2). So outside_max - outside_min is 200-2=198. Inside_max is 100, inside_min is 1. Total 198 + 99 = 297. The pair (1,200) (indices 2 and 3):\n\noutside_max: contains 200 (global_max), so outside_max is second_max (100). outside_min: contains 1 (global_min), so outside_min is second_min (2). outside difference: 100-2=98. Inside_max is 200, inside_min is 1. Total 98+199=297. This is the maximum. Thus, the code would capture this. Now, the code for program1.py is filled in as above. Now, moving to program2.py.",
      "start_char": 64938,
      "end_char": 66267,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "The problem is to count the number of ways to express n as a sum of palindromic numbers, where the order doesn't matter (multiset). The constraints are n up to 4e4 and t up to 1e4. The code provided is:\n\ng=10**9+7\nv=[1]+[0]*40001\nfor i in range(1,40001):\n    if str(i)==str(i)[::-1]:\n        for j in range(i,40001):# TODO: Your code here\nfor n in[*open(0)][1:]:print(v[int(n)]%g)\n\nThe code is using dynamic programming. The idea is that v[j] is the number of ways to form j as a sum of palindromes. The code initializes v[0] =1. For each palindrome i, we iterate over j from i to 4e4 and update v[j] += v[j -i]. This is the standard unbounded knapsack approach. The missing code is the inner loop. The current code has:\n\nfor i in range(1,40001):\n    if is_palindrome(i):\n        for j in range(i,40001):\n            v[j] += v[j -i]\n            v[j] % = g \n\nThus, the missing code is:\n\nfor j in range(i, 40001):\n    v[j] = (v[j] + v[j -i]) % g \n\nSo the TODO line should be:\n\nfor j in range(i, 40001):\n\nand then inside the loop, v[j] += v[j-i], mod g. Thus, the code for program2.py's missing part is:\n\nThe inner loop should be:\n\nfor j in range(i, 40001):\n    v[j] = (v[j] + v[j-i]) % g \n\nSo the code for program2.py's missing part is the loop and the assignment. Now, program3.py. The problem is to determine if it's possible to make all a_i for i>=2 zero by repeatedly subtracting a_{i-1} from a_i. The code provided has a function diff_ops which returns whether all a_i are divisible by a_1. The test cases are read, but the code for reading them is incomplete. The current code:\n\nimport sys\n\ndef diff_ops(arr):\n    result = True\n    for i in range(1, len(arr)):\n        result = result and arr[i] % arr[0] == 0\n    return result\n\nif __name__ == \"__main__\":\n    input_arr = list(map(int, sys.stdin.read().split()))\n    len_input = len(input_arr)\n    n = input_arr[0]\n    test_cases = []\n    pos = 1\n    while pos <= len_input - 1:\n        # TODO: Your code here\n    for case in test_cases:\n        print(\"YES\" if diff_ops(case) else \"NO\")\n\nThe problem requires that after some operations, all a_i for i>=2 are zero. The key insight is that the final array must be [a_1, 0, 0, ..., 0]. The operations allow us to subtract a_{i-1} from a_i any number of times. This is equivalent to being able to reduce a_i to zero modulo a_1. Wait, the operations are similar to the Euclidean algorithm. The process can be viewed as follows: \n\nEach a_i must be a multiple of a_1. Because each operation on a_i reduces it by a multiple of a_{i-1}. But the process must eventually reach zero. The key is that all elements must be divisible by a_1. Because each step reduces a_i by multiples of a_{i-1}, but the initial a_1 remains unchanged. Thus, the condition is that every element in the array must be divisible by a_1. The function diff_ops checks exactly this. Thus, the code's current function is correct. The missing part is reading the test cases properly.",
      "start_char": 66272,
      "end_char": 69272,
      "label": "code_analysis",
      "label_info": {
        "type": "code_analysis"
      }
    },
    {
      "text": "The input is multiple test cases. The first line is t. Then for each test case: \n\nThe first line is n, then the next line has n numbers. The current code reads all input into input_arr. The first element is t, then for each test case, the next two elements are n and the array. The code needs to read the test cases properly. The current code has:\n\npos =1 \n\nwhile pos <= len_input -1:\n\n    # read n \n\n    n = input_arr[pos]\n\n    pos +=1 \n\n    # read the next n elements \n\n    arr = input_arr[pos: pos+n]\n\n    test_cases.append(arr)\n\n    pos +=n \n\nThus, the missing code is: while pos <= len_input -1:\n\n    n = input_arr[pos]\n\n    pos +=1\n\n    arr = input_arr[pos:pos+n]\n\n    test_cases.append(arr)\n\n    pos +=n \n\nThus, the code for the TODO section is: while pos <= len_input -1:\n\n    n = input_arr[pos]\n\n    pos +=1\n\n    arr = input_arr[pos:pos+n]\n\n    test_cases.append(arr)\n\n    pos +=n \n\nSo putting it all together, the missing code for program3.py is the loop and the reading of the test cases. Thus, the three programs' missing parts are:\n\nprogram1.py: the code outlined above. program2.py: the inner loop and assignment. program3.py: the loop to read test cases. Now, formatting the answer as JSON with the missing code for each program.",
      "start_char": 69275,
      "end_char": 70541,
      "label": "code_analysis",
      "label_info": {
        "type": "code_analysis"
      }
    },
    {
      "text": "The code for program1.py is the code I outlined earlier. But the user's code for program1.py has the initial loop and the TODO. The user's code for program1.py:\n\nfor _ in range(int(input())):\n    # TODO: Your code here\n\nThe missing code is the entire block inside the loop. The code I outlined earlier is the complete code for the loop body. Thus, the completion for program1 is the code inside the loop. Similarly for the other programs. Now, the final answer is the JSON with the three completions. The code for program1.py's completion is the entire block inside the loop. The code for program2.py's completion is the inner loop and the assignment. The code for program3.py's completion is the loop to read the test cases. Now, writing the JSON:\n\n{\n    \"program1\": \"\"\"\n    n = int(input())\n    a = list(map(int, input().split())) global_max = max(a) global_min = min(a)\n    # compute second_max and second_min\n    first_max = -float('inf')\n    second_max = -float('inf')\n    for num in a:\n        if num > first_max:\n            second_max, first_max = first_max, num\n        elif num > second_max:\n            second_max = num\n    first_min = float('inf')\n    second_min = float('inf')\n    for num in a:\n        if num < first_min:\n            second_min, first_min = first_min, num\n        elif num < second_min:\n            second_min = num\n    # compute prefix and suffix arrays\n    prefix_max = [0]*n\n    prefix_min = [0]*n\n    prefix_max[0] = a[0]\n    prefix_min[0] = a[0]\n    for i in range(1, n):\n        prefix_max[i] = max(prefix_max[i-1], a[i])\n        prefix_min[i] = min(prefix_min[i-1], a[i])\n    suffix_max = [0]*n\n    suffix_min = [0]*n\n    suffix_max[-1] = a[-1]\n    suffix_min[-1] = a[-1]\n    for i in range(n-2, -1, -1):\n        suffix_max[i] = max(suffix_max[i+1], a[i])\n        suffix_min[i] = min(suffix_min[i+1], a[i])\n    # compute first candidate\n    first_candidate = 0\n    for i in range(n):\n        left_max = prefix_max[i-1] if i >0 else -float('inf')\n        right_max = suffix_max[i+1] if i <n-1 else -float('inf')\n        max_without = max(left_max, right_max) if left_max ! = -float('inf') or right_max ! = -float('inf') else 0\n        left_min = prefix_min[i-1] if i>0 else float('inf')\n        right_min = suffix_min[i+1] if i <n-1 else float('inf')\n        min_without = min(left_min, right_min)\n        current_diff = max_without - min_without\n        if current_diff > first_candidate: first_candidate = current_diff\n    # compute second candidate\n    second_candidate = 0\n    for i in range(n-1):\n        a_i = a[i]\n        a_j = a[i+1]\n        if a_i == global_max or a_j == global_max:\n            outside_max = second_max\n        else:\n            outside_max = global_max\n        if a_i == global_min or a_j == global_min:\n            outside_min = second_min\n        else:\n            outside_min = global_min\n        inside_max = max(a_i, a_j)\n        inside_min = min(a_i, a_j)\n        current_beauty = (outside_max - outside_min) + (inside_max - inside_min)\n        if current_beauty > second_candidate:\n            second_candidate = current_beauty\n    ans = max(first_candidate, second_candidate)\n    print(ans) \"\"\",\n    \"program2\": \"\"\"\n    for j in range(i, 40001):\n        v[j] = (v[j] + v[j - i]) % g\n    \"\"\",\n    \"program3\": \"\"\"\n    while pos <= len_input - 1:\n        n = input_arr[pos]\n        pos += 1\n        arr = input_arr[pos:pos + n]\n        test_cases.append(arr)\n        pos += n\n    \"\"\"\n} But I need to ensure that the code is properly formatted without markdown and as strings. Also, in program1's code, the initial 'n = int(input())' is needed. Wait, the user's code for program1 starts with:\n\nfor _ in range(int(input())): # TODO: Your code here\n\nSo the completion should include the entire code inside the loop. The code I wrote earlier starts with n = int(input()), which is correct. The code for program2's missing part is the inner loop's body. The code for program3's missing part is the loop to read the test cases.",
      "start_char": 70544,
      "end_char": 74592,
      "label": "bug_fixing",
      "label_info": {
        "type": "bug_fixing"
      }
    },
    {
      "text": "Thus, the JSON should be as above. But I need to ensure that the code is properly formatted as strings without any markdown.",
      "start_char": 74595,
      "end_char": 74719,
      "label": "mental_execution",
      "label_info": {
        "type": "mental_execution"
      }
    },
    {
      "text": "Also, in program1's code, the 'first_max' and 'second_max' computation may have to handle multiple occurrences of the global_max. But the code I wrote should handle that. The code for program1's completion is the entire block inside the loop. The code for program2's completion is the inner loop's code. The code for program3's completion is the loop to read the test cases. Thus, the final answer is the JSON with these three strings.",
      "start_char": 74724,
      "end_char": 75169,
      "label": "code_analysis",
      "label_info": {
        "type": "code_analysis"
      }
    }
  ],
  "metadata": {
    "task_id1": "block_completion_005388",
    "task_id2": "block_completion_004780",
    "task_id3": "block_completion_008176"
  },
  "original_reasoning": "Okay, let's tackle these three programs one by one. \n\nStarting with program1.py. The problem is to find the maximum beauty of a proper subsegment. The beauty is calculated as the difference between max and min of the elements outside the subsegment plus the difference between max and min of the subsegment itself. Hmm, the key here is to compute this efficiently because the array can be up to 1e5 elements, and with multiple test cases, a naive approach would be too slow.\n\nFirst, I need to think about how to compute the max and min for the parts outside the subsegment [l, r]. The straightforward way would be for each possible l and r, compute the max and min of the entire array except the subsegment. But that's O(n^2), which is way too slow for n=1e5.\n\nWait, maybe precompute prefix and suffix max and min arrays. Like, for each position i, have the max from the start up to i, and the max from i to the end. Similarly for min. Then, for any l and r, the combined max and min outside would be the max of (prefix_max[l-1], suffix_max[r+1]) and similarly for min. Wait, actually, the outside part is the elements before l and after r. So the max of the outside is the maximum between the max of the first l-1 elements and the max of the elements from r+1 to n. Similarly for the min. \n\nSo, to precompute these, we can have:\n\nprefix_max array where prefix_max[i] is the maximum from a[0] to a[i].\n\nprefix_min array where prefix_min[i] is the minimum from a[0] to a[i].\n\nSimilarly, suffix_max[i] is the maximum from a[i] to a[n-1].\n\nsuffix_min[i] is the minimum from a[i] to a[n-1].\n\nThen, for a subsegment from l to r (0-based?), the outside max would be max( prefix_max[l-1], suffix_max[r+1] ), and the outside min would be min( prefix_min[l-1], suffix_min[r+1] ). The inside part's max and min can be found by another precomputed array for ranges. But how?\n\nAlternatively, for the inside part (the subsegment l to r), we need the max and min of a[l..r]. To compute this quickly for any l and r, we can use a segment tree or a sparse table for range max and min queries. But even with that, for each possible l and r, doing a query would be O(1) with sparse tables, but the total number of l and r pairs is O(n^2), which is still too big.\n\nHmm, so maybe there's a smarter way. Let's think of the maximum possible beauty. The beauty is (outside_max - outside_min) + (inside_max - inside_min). To maximize this, perhaps the best is when the outside_max is as large as possible, outside_min as small as possible, and the inside's max and min also contribute. \n\nAlternatively, maybe the maximum beauty is simply (global_max - global_min) + (max_subsegment - min_subsegment). But that's only if the subsegment is chosen such that the outside includes the global max and min, and the subsegment also has its own max and min. Wait, but the subsegment can't be the entire array, so the outside would be empty? Wait, the problem states that it's a proper subsegment, so the subsegment can't be the entire array. So the outside is non-empty. \n\nWait, the outside is the elements not in the subsegment. So the outside must have at least one element. So the outside's max and min are valid. \n\nHmm, perhaps the maximum possible beauty is (global_max - global_min) plus the maximum possible (inside_max - inside_min) for any subsegment. But that might not be correct because the outside's max and min could be different when the subsegment is chosen. \n\nAlternatively, maybe the maximum beauty is (global_max - global_min) plus the maximum (inside_max - inside_min) of any possible subsegment. Because the outside's max and min would be the global ones, so their difference is fixed. But then the inside's difference can be added. But that would only be possible if the subsegment doesn't include the global max or min. Wait, but if the subsegment includes the global max, then the outside's max would be less than the global max. So that approach might not work. \n\nHmm, perhaps the maximum beauty is the maximum over all possible subsegments of ( (max_outside - min_outside) + (max_inside - min_inside) ). To compute this efficiently, we need a way to compute for all possible subsegments the four values quickly. \n\nAlternatively, maybe the maximum possible value of (max_outside - min_outside) is the global_max - global_min, which can be achieved by choosing a subsegment that excludes at least one element from the global max and min. Wait, but if the subsegment excludes the global max, then the outside's max would be the next highest, so maybe not. \n\nAlternatively, perhaps the maximum beauty is (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment. But that's only possible if the subsegment's inside doesn't include the global max or min. Not sure. \n\nAlternatively, maybe the maximum beauty is (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment. Because the outside's max and min can be the global ones, so their difference is fixed. But the subsegment can be any proper subsegment. Wait, but the subsegment can't be the entire array, so the outside is non-empty. So if the subsegment is the entire array except one element, then the outside is that one element. So the outside's max and min would be that element. So in that case, the outside's difference is zero. \n\nHmm, this is getting complicated. Maybe the optimal subsegment is such that the outside has the global max and min, so their difference is (global_max - global_min), and the inside has its own max and min. So the total would be (global_max - global_min) + (max_inside - min_inside). To maximize this, we need the inside's max and min to be as large as possible. \n\nAlternatively, perhaps the maximum possible beauty is (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment. Because the outside can be arranged to have the global max and min. \n\nWait, but how can the outside have the global max and min? The subsegment must exclude at least one element. So if the subsegment doesn't include the element with the global max, then the outside's max is the global max. Similarly, if the subsegment doesn't include the element with the global min, then the outside's min is the global min. So to have both, the subsegment must exclude at least one element that is not the global max or min. Wait, maybe the subsegment can exclude the global max, but include the global min. Then the outside's max would be less than the global max. \n\nHmm, perhaps the best approach is to precompute for all possible subsegments the four values, but that's O(n^2), which is not feasible. \n\nAlternative idea: The maximum beauty can be obtained by considering two cases:\n\n1. The subsegment is such that the outside includes the global max and min. Then the outside's difference is (global_max - global_min). The inside's difference can be anything. So the total is (global_max - global_min) + (max_inside - min_inside). To maximize this, we need the maximum (max_inside - min_inside) over all possible subsegments. \n\n2. The subsegment excludes either the global max or the global min, so the outside's difference is less than (global_max - global_min). But maybe in some cases, the inside's difference is so large that the total is better. \n\nSo the maximum between these two cases would be the answer. \n\nSo first, compute the global_max and global_min. Then compute the maximum (max_inside - min_inside) over all possible subsegments. Then the first case gives (global_max - global_min) + (max_diff_inside). \n\nBut there's also other possibilities where the outside's difference is higher than (global_max - global_min)? No, because the outside is a subset of the entire array, so their max can't exceed the global_max, and min can't be lower than the global_min. So the maximum possible outside difference is (global_max - global_min). \n\nTherefore, the first case is the best possible scenario. So the maximum beauty would be (global_max - global_min) plus the maximum possible (max_inside - min_inside) of any subsegment. \n\nWait, but the subsegment must be a proper subsegment. So the entire array is not allowed. So the maximum (max_inside - min_inside) over all proper subsegments. \n\nWait, but the maximum (max_inside - min_inside) for a subsegment could be the same as the global difference. For example, if the entire array's max and min are in a subsegment. But since the subsegment can't be the entire array, then the maximum possible (max_inside - min_inside) would be the same as the global difference only if there exists a proper subsegment that includes both the global max and min. \n\nHmm, but in that case, the outside would exclude at least one element. So the outside's max and min would be the global ones only if the subsegment doesn't exclude the global max or min. \n\nWait, this is getting a bit tangled. Let me think of an example. \n\nTake the first sample input given in the problem:\n\nSample Input 1:\n\nSample Input 1:\n\nFirst test case: array [1, 2, 3, 4, 5, 6, 1, 5]. The optimal subsegment is l=7, r=8 (assuming 1-based). The outside is the first 6 elements and the 8th? Wait, maybe the array is 1-based. Let me see the note: the optimal segment is l=7, r=8. The outside would be the first 6 elements and the elements after 8 (but there are none). Wait, the array length is 8? So the outside is the first 6 elements (since r is 8, so r+1 is 9 which is beyond n). So the outside's max is 6 (from the first 6 elements) and min is 1. So their difference is 5. The inside is [1,5], so max 5, min 1, difference 4. Total 5+4=9. \n\nThe global max is 6, global min is 1. So (6-1) + (5-1) = 5+4=9. So that's exactly the case where the outside includes the global max and min. \n\nSo the approach of taking (global_max - global_min) plus the maximum (max_inside - min_inside) of any proper subsegment would work here. \n\nAnother example: the second sample input. The array is [2, 100, 1, 200, 3]. The optimal subsegment is l=2 to 4 (elements 100,1,200). The outside includes the first element (2) and the last (3). The outside's max is 200 (wait, no, the outside is the elements before l=2 (element 2) and after r=4 (element 3). So the outside's elements are 2 and 3. Their max is 3, min is 2. So their difference is 1. The inside's max is 200, min 1. So total is 1 + (200-1) = 200. But according to the note, the answer is (100-2) + (200-1) = 98 + 199 = 297. Wait, that contradicts. Wait, maybe I made a mistake here. \n\nWait the note says the optimal is l=2, r=4. The outside is the elements before l=2 (element 2) and after r=4 (element 3). So the outside elements are 2 and 3. The max of those is 3, min is 2. So their difference is 1. The inside's max is 200, min is 1. So total is 1 + (200-1) = 200. But the note says the beauty is (100-2) + (200-1) = 98 + 199 = 297. Wait, that's different. So my previous approach is wrong. \n\nHmm, so what's wrong here? Let me re-calculate the example. \n\nWait the array in the second test case is [2, 100, 1, 200, 3]. The subsegment is l=2 to r=4 (indices 2,3,4 in 1-based). The outside elements are the first element (2) and the fifth (3). The max of the outside is max(2,3) =3, min is 2. So their difference is 1. The inside elements are 100,1,200. Their max is 200, min is 1. So the total is 1 + (200-1) = 200. But according to the note, the beauty is (100-2) + (200-1) = 98 + 199 = 297. Wait, that's conflicting. \n\nWait, perhaps I misunderstood the problem's description. Let me re-read the problem statement. \n\nThe beauty is defined as:\n\nmax(a_1 ... a_{l-1}, a_{r+1} ... a_n) minus min of those same elements, plus the max of the subsegment minus the min of the subsegment. \n\nAh! Oh right, the first part is (max of the outside elements) minus (min of the outside elements). The second part is (max of the subsegment) minus (min of the subsegment). \n\nSo in the second example's case, the outside elements are 2 and 3. Their max is 3, min is 2. So 3-2 =1. The inside's max is 200, min is 1. So 200-1=199. Total is 1+199=200. But the note says the answer is (100-2) + (200-1) = 98+199=297. Wait, that's different. \n\nHmm, so I must have misunderstood the example. Let me check the note again. \n\nThe note says: \"In the second test case, the optimal segment is l=2, r=4. The beauty equals (100-2) + (200-1) = 297\". \n\nWait, how does that happen? \n\nWait the outside elements are the elements before l=2 (which is the first element, 2) and after r=4 (the fifth element, 3). So the outside elements are 2 and 3. Their max is 3, min is 2. So their difference is 1. The inside's max is 200, min is 1. So the total should be 1 + (200-1) = 200. But the note says 297. \n\nHmm, this suggests that I have a misunderstanding of the problem. Let me re-read the problem's description. \n\nAh! Wait, the first part is the max of the outside elements minus the min of the outside elements. The second part is the max of the subsegment minus the min of the subsegment. \n\nWait in the note's example, the outside's max is 100? No, that can't be. Wait the outside elements are the elements not in the subsegment. The subsegment is from l=2 to r=4. So the outside elements are the first element (2) and the fifth (3). So their max is 3, min is 2. \n\nWait the note's calculation says (100-2) + (200-1). So where does the 100 come from? \n\nWait maybe the subsegment is l=2 to r=4, so the outside includes the first element (2) and the fifth (3). The max of the outside is 3, min is 2. So the first part is 1. The second part is (200-1) =199. So total 200. But the note says 297. \n\nHmm, this discrepancy suggests that I must have misread the problem's example. Let me check the note again. \n\nThe note says: \"In the second test case, the optimal segment is l=2, r=4. The beauty of this segment equals (100-2) + (200-1) = 297\". \n\nWait, so the first part is 100-2, which would imply that the outside's max is 100 and min is 2. But the outside elements are 2 and 3. So their max is 3, not 100. \n\nThis is confusing. Maybe the array in the second test case is different? Let me see the note's example again. \n\nThe note says: \"the optimal segment is l=2, r=4. The beauty equals (100-2) + (200-1) = 297\". \n\nAh! Wait, perhaps the array is [2, 100, 1, 200, 3]. The subsegment is from 2 to 4 (indices 2,3,4 in 1-based). The outside elements are the first element (2) and the fifth (3). The max of the outside is 3, min is 2. So the first part is 1. The second part is (200-1) =199. So total 200. But the note says 297. \n\nHmm, this suggests that perhaps the array is different. Maybe the array is [2, 100, 1, 200, 3, ...] with more elements? Or perhaps I made a mistake in the indices. \n\nAlternatively, maybe the problem's note has a typo, but that's unlikely. \n\nAlternatively, perhaps the outside includes the elements before l and after r. So for l=2 and r=4, the outside is the elements before l (elements 1) and after r (elements 5 and beyond). So in the array of length 5, the elements after r=4 are element 5. So the outside elements are 2 (element 1) and 3 (element5). \n\nWait, but the first part of the calculation in the note is 100-2. So the outside's max is 100? That can't be. Unless the outside includes the subsegment's elements? No, that's not possible. \n\nHmm, maybe I misunderstood the problem's definition. Let me re-read the problem statement. \n\nThe problem says: the beauty is the max of the elements outside the subsegment minus the min of those elements, plus the max of the subsegment minus the min of the subsegment. \n\nWait, the first part is the max of the elements not in the subsegment, minus the min of those elements. The second part is the max of the subsegment minus the min of the subsegment. \n\nIn the second example's note, the first part is (100-2). So the outside's max is 100 and min is 2. That would mean that the outside includes the element 100. But the subsegment is from 2 to 4, so the element 100 is part of the subsegment. So that can't be. \n\nWait, perhaps the subsegment is l=2 to r=4, so the elements in the subsegment are 100,1,200. The outside elements are the first element (2) and the fifth (3). So their max is 3, min is 2. So the first part is 1. The second part is (200-1)=199. Total 200. But the note says 297. \n\nHmm, this is a problem. Maybe the array in the second test case is different. Let me think again. \n\nWait the note says the second test case's answer is 297. The calculation is (100-2) + (200-1) = 98 + 199 = 297. So the first part is 100-2, which implies that the outside's max is 100 and min is 2. So the outside must include the element 100. But that's part of the subsegment. \n\nThis is a contradiction. So perhaps the subsegment is l=2 to r=3? Let's see. Then the subsegment is 100 and 1. The outside elements are 2 (before), and 200 and 3 (after). The outside's max is 200, min is 2. So their difference is 198. The subsegment's max is 100, min 1. So total 198 + 99 = 297. That matches the note. \n\nAh! So perhaps the subsegment is l=2 to r=3. Then the outside includes the first element (2), the fourth (200), and fifth (3). So the max is 200, min is 2. So 200-2=198. The subsegment's max is 100, min 1. So 198+99=297. \n\nSo the note's example must have the subsegment l=2 to r=3. But the note says l=2, r=4. So perhaps there's a mistake in the note's description. Or perhaps I'm misunderstanding the indices. \n\nAlternatively, maybe the array is different. Let me think again. \n\nAlternatively, maybe the array is [2, 100, 1, 200, 3]. The subsegment l=2 to r=4 (elements 100,1,200). The outside elements are 2 and 3. So their max is 3, min 2. So first part is 1. The subsegment's max is 200, min 1. So total 1+199=200. But the note says 297. \n\nHmm, this is a problem. Maybe I'm missing something. \n\nAlternatively, perhaps the outside includes the entire array except the subsegment. So for the subsegment l=2 to r=4, the outside is the first element (2) and the fifth (3). So their max is 3, min 2. \n\nWait, but the note's calculation must be correct. So perhaps the array is different. Let me think of another possibility. \n\nSuppose the array is [2, 100, 1, 200, 3, 4]. Then the subsegment l=2 to r=4 (elements 100,1,200). The outside elements are 2, 3,4. Max is 4, min 2. So first part is 2. The subsegment's max is 200, min 1. So total 2+199=201. Not 297. \n\nHmm. \n\nAlternatively, maybe the array is [2, 100, 1, 200, 3]. The subsegment is l=1 to r=4. But that's not a proper subsegment because the entire array length is 5, so the subsegment length is 4, which is less than 5. So it's allowed. The outside is the fifth element (3). So the outside's max and min are 3. So first part is 0. The subsegment's max is 200, min 1. So total 0+199=199. \n\nHmm. \n\nAlternatively, maybe the subsegment is l=1 to r=3. The outside is the elements 4 and 5 (200 and 3). Max is 200, min 3. So first part is 197. The subsegment's max is 100, min 1. So total 197 + 99 = 296. Close but not 297. \n\nHmm. \n\nAlternatively, perhaps the array is [2, 100, 1, 200, 3, 200]. Then the subsegment l=2 to r=4 (elements 100,1,200). The outside includes 2, 200, 3, 200. Max is 200, min 2. So first part is 198. The subsegment's max is 200, min 1. So total 198+199= 397. Not matching. \n\nHmm, perhaps I'm missing something here. Let me re-calculate the note's example. \n\nThe note says the second test case's optimal subsegment is l=2, r=4. The beauty is (100-2) + (200-1) = 98+199=297. \n\nSo the first part is 100-2. So the outside's max is 100, min is 2. \n\nThe outside elements must include 100. But the subsegment includes l=2 (the element 100). So that's impossible. \n\nWait, maybe the subsegment is l=3 to r=4? Then the outside includes the first two elements (2 and 100) and the fifth (3). The max of the outside is 100, min is 2. So first part is 98. The subsegment's elements are 1 and 200. Their max is 200, min 1. So total 98+199=297. That matches. \n\nAh! So the subsegment is l=3 to r=4. Then the outside includes elements before l (elements 1 and 2: 2 and 100) and after r (element 5:3). So the outside's max is 100, min is 2. So the first part is 98. The subsegment's max is 200, min 1. So total 297. \n\nSo the note's example must have the subsegment l=3 to r=4. But the note says l=2, r=4. So perhaps there's a mistake in the note's description. \n\nWell, regardless, the problem requires us to find the maximum over all possible proper subsegments. \n\nBack to the approach. \n\nThe key is to find for each possible subsegment the four values (outside_max, outside_min, inside_max, inside_min). \n\nTo compute this efficiently, perhaps precompute prefix and suffix arrays for max and min. \n\nLet me think of the steps:\n\nFor each test case:\n\n1. Read the array a of length n.\n\n2. Precompute prefix_max, prefix_min arrays. \n\nprefix_max[i] is the maximum of a[0..i]\n\nprefix_min[i] is the minimum of a[0..i]\n\nSimilarly, suffix_max[i] is the maximum of a[i..n-1]\n\nsuffix_min[i] is the minimum of a[i..n-1]\n\nThese can be computed in O(n) time each. \n\nThen, for any subsegment from l to r (0-based indices?), the outside elements are the elements before l and after r. \n\nThe outside_max is the maximum between prefix_max[l-1] (if l>0) and suffix_max[r+1] (if r <n-1). \n\nSimilarly, the outside_min is the minimum between prefix_min[l-1] and suffix_min[r+1]. \n\nThe inside_max is the maximum of a[l..r], which can be found using the suffix_max and prefix_max arrays? Or perhaps using the suffix_max array. \n\nWait, the maximum from l to r is the maximum between a[l] to a[r]. To get that quickly, we can precompute a 2D array for range max, but that's O(n^2) space which is not feasible. \n\nAlternatively, using the suffix_max array. \n\nWait, the maximum from l to r is the maximum between the suffix_max[l] and the suffix_max[r]? No, that's not correct. \n\nAlternatively, the maximum from l to r can be found as the maximum between prefix_max[r] and suffix_max[l]. Wait, no. \n\nHmm, perhaps the maximum from l to r can be found using a segment tree or a sparse table for range maximum queries. \n\nSimilarly for the minimum. \n\nSo, to compute the inside_max and inside_min for any l and r, we can use a range maximum and minimum query. \n\nThe problem is that for each possible l and r, we need to compute these four values. \n\nThe total number of possible subsegments is O(n^2), which is way too big for n=1e5. \n\nSo this approach is not feasible. \n\nHmm, so we need a smarter way. \n\nAlternative Idea: The maximum beauty is the maximum over all possible subsegments of ( (outside_max - outside_min) + (inside_max - inside_min) ). \n\nLet me think of the terms:\n\nThe outside_max is the maximum of the elements not in the subsegment. \n\nThe outside_min is the minimum of the elements not in the subsegment. \n\nThe inside_max is the maximum of the subsegment. \n\nThe inside_min is the minimum of the subsegment. \n\nThe total is (outside_max - outside_min) + (inside_max - inside_min). \n\nHmm, perhaps this can be rewritten as (outside_max + inside_max) - (outside_min + inside_min). \n\nNot sure if that helps. \n\nAlternatively, note that the outside_max is the maximum between the prefix_max up to l-1 and the suffix_max from r+1. \n\nSimilarly for the outside_min. \n\nThe inside_max is the maximum between l and r. \n\nThe inside_min is the minimum between l and r. \n\nHmm. \n\nAnother Idea: The maximum possible value of (outside_max - outside_min) is the global_max - global_min. To achieve this, the subsegment must exclude at least one element from the global_max and/or global_min. \n\nWait, no. To have the outside_max be the global_max, the subsegment must not include the element(s) where the global_max occurs. Similarly, to have the outside_min be the global_min, the subsegment must not include the element(s) where the global_min occurs. \n\nSo, to have the outside_max - outside_min equal to global_max - global_min, the subsegment must exclude at least one occurrence of the global_max and/or exclude at least one occurrence of the global_min. \n\nWait, no. For example, if the subsegment excludes the global_max, then the outside_max is the global_max. But if it includes the global_min, then the outside_min could still be the global_min. \n\nSo, to have the outside_max be the global_max and the outside_min be the global_min, the subsegment must exclude at least one occurrence of the global_max and exclude at least one occurrence of the global_min. \n\nAlternatively, the subsegment can exclude either the global_max or the global_min, but not both. \n\nHmm, this is getting too complicated. \n\nPerhaps the maximum possible beauty is (global_max - global_min) plus the maximum possible (inside_max - inside_min) of any subsegment. \n\nBut in the second example's note, the maximum (inside_max - inside_min) would be 200-1=199. Adding to (global_max - global_min) which is 200-2=198, gives 198+199=397, which is higher than the note's 297. But the note's example's answer is 297. \n\nHmm, so that approach is not correct. \n\nHmm, so maybe the maximum beauty is not simply the sum of the two terms. \n\nAlternative Idea: Let's think of the maximum possible value of (outside_max - outside_min) + (inside_max - inside_min). \n\nSuppose the subsegment is chosen such that the outside_max is as large as possible and the inside_max is also as large as possible. \n\nAlternatively, perhaps the maximum beauty is the maximum between (global_max - global_min) and (max_subsegment's (max - min) + (global_max - global_min)), but I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) + (max_sub - min_sub), where the sub is a proper subsegment. \n\nWait, but in the first example, the global_max is 6, global_min is 1. The sub's max is 5, min 1. So 5-1=4. So total is 5 (6-1) +4 =9, which matches the example. \n\nIn the second example's note, the global_max is 200, global_min is 1 (assuming the array is [2,100,1,200,3]). The subsegment's max is 200, min 1. So their difference is 199. The outside's difference is (100-2) =98. So total is 98+199=297. \n\nThe global_max - global_min is 200-1=199. So adding the sub's difference (199) would give 398, which is higher than the note's answer. But that's not possible because the outside's difference is 98. \n\nHmm, so the approach of adding the two terms is not correct. \n\nHmm, so perhaps the maximum beauty is the maximum over all possible subsegments of (outside_max - outside_min) + (inside_max - inside_min). \n\nTo compute this efficiently, perhaps we can find for each possible position where the subsegment ends or starts, but I'm not sure. \n\nAlternative Idea: Let's consider that the maximum beauty can be obtained by choosing a subsegment that excludes either the global_max or the global_min. \n\nWait, but how? \n\nAlternatively, the maximum beauty is the maximum between (global_max - some_min) + (some_max - some_min_sub), but I'm not sure. \n\nHmm, perhaps the key is to realize that the maximum possible beauty is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any subsegment that excludes the global_max or the global_min. \n\nAlternatively, perhaps the maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments. \n\nTo compute this efficiently, perhaps we can precompute for all possible subsegments the four values, but that's O(n^2), which is not feasible. \n\nHmm, perhaps the maximum beauty is the maximum of (max_a - min_a) plus (max_sub - min_sub), but only when the subsegment excludes at least one element. \n\nWait, but the first term (max_a - min_a) is the global difference. The second term is the sub's difference. But the outside's difference would be less than or equal to the global difference. \n\nHmm, this is really tricky. \n\nAlternative Idea: Let's think of the maximum possible value of (outside_max - outside_min) + (inside_max - inside_min). \n\nThis can be rewritten as (outside_max + inside_max) - (outside_min + inside_min). \n\nHmm, perhaps we can find the maximum of (outside_max + inside_max) and the minimum of (outside_min + inside_min). \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum is achieved when the subsegment is the entire array except one element. \n\nBecause then the outside is just that one element, so outside_max and outside_min are the same (the element itself), so their difference is zero. The inside is the rest, so the inside's difference is (max_inside - min_inside). \n\nAlternatively, the maximum could be when the subsegment is the entire array except the first element. Then the outside is the first element, so difference zero. The inside's difference is (max of the rest - min of the rest). \n\nSimilarly for excluding the last element. \n\nAlternatively, the maximum could be when the subsegment is the entire array except the global_max. Then the outside's max is the global_max, and the outside's min is the global_min (if the subsegment excludes the global_max but includes the global_min). \n\nHmm, this is getting too vague. \n\nPerhaps the correct approach is to precompute for all possible subsegments the four values using prefix and suffix arrays and range max/min queries, but find a way to do this in O(n) or O(n log n) time. \n\nLet me think of the steps again. \n\nFirst, precompute prefix_max, prefix_min, suffix_max, suffix_min arrays. \n\nThen, for any subsegment [l, r], the outside_max is the maximum between prefix_max[l-1] (if l>0) and suffix_max[r+1] (if r <n-1). \n\nSimilarly, outside_min is the minimum between prefix_min[l-1] and suffix_min[r+1]. \n\nThe inside_max is the maximum of a[l..r], which can be found using a range max query. \n\nThe inside_min is the minimum of a[l..r], using a range min query. \n\nThe problem is to find the maximum of (outside_max - outside_min) + (inside_max - inside_min) over all possible l and r where the subsegment is proper (i.e., not the entire array). \n\nThe key is to find this maximum efficiently. \n\nThe range max and min queries can be done in O(1) per query with a sparse table. \n\nThe sparse table can be built in O(n log n) time. \n\nSo the steps would be:\n\nFor each test case:\n\n1. Read the array a. \n\n2. Precompute prefix_max, prefix_min, suffix_max, suffix_min arrays. \n\n3. Build a sparse table for range max and min queries. \n\n4. Iterate over all possible l and r (but this is O(n^2), which is too slow for n=1e5). \n\nHmm, so this approach is not feasible. \n\nHmm, perhaps there's a way to find the maximum without iterating all possible l and r. \n\nLet me think of the terms again. \n\nThe expression is (outside_max - outside_min) + (inside_max - inside_min). \n\nLet me see if this can be rewritten as (outside_max + inside_max) - (outside_min + inside_min). \n\nYes. \n\nSo the goal is to maximize this expression. \n\nHmm, perhaps the maximum occurs when outside_max + inside_max is as large as possible and outside_min + inside_min is as small as possible. \n\nBut how to find this? \n\nAlternatively, perhaps the maximum is achieved when the subsegment is the entire array except one element. \n\nLet me see. \n\nSuppose the subsegment is the entire array except the first element. Then the outside is the first element. So outside_max and outside_min are a[0]. Their difference is zero. The inside is the rest of the array. The inside's max and min are the global max and min (excluding a[0]). \n\nWait, but the global max could be in the inside. \n\nHmm, but in this case, the total would be (0) + (max_inside - min_inside). \n\nAlternatively, if the subsegment excludes the first element, then the inside's max could be the global max (if it's not the first element). \n\nHmm, but this might not be the maximum. \n\nAlternatively, perhaps the maximum is achieved when the subsegment is the entire array except the first element or the last element. \n\nLet me test this with the first example. \n\nFirst example's array is [1,2,3,4,5,6,1,5]. The optimal subsegment is l=7, r=8 (assuming 1-based, so 0-based indices 6 and 7). The outside is the first 6 elements (indices 0-5). Their max is 6, min is 1. So their difference is 5. The inside is [1,5], max 5, min 1. So total 5+4=9. \n\nIf we take the subsegment excluding the first element (indices 1-7), then the outside is a[0]=1. The inside's max is 6, min 1. So the total is (0) + (6-1) =5, which is less than 9. \n\nSo the maximum is not achieved in this case. \n\nHmm. \n\nAnother Idea: The maximum beauty can be obtained by choosing a subsegment that excludes either the global_max or the global_min. \n\nSuppose the subsegment excludes the global_max. Then the outside_max is the global_max. The outside_min could be the global_min (if the subsegment includes it). \n\nThe inside's max would be the maximum of the subsegment, which could be less than the global_max. \n\nHmm, but this might not be better than other options. \n\nAlternatively, perhaps the maximum is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any subsegment that excludes the global_max or the global_min. \n\nBut how to compute this efficiently? \n\nAlternatively, the maximum beauty is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any subsegment that excludes the global_max, and similarly for excluding the global_min. \n\nBut how to compute the maximum (inside_max - inside_min) for subsegments that exclude the global_max? \n\nHmm, perhaps the maximum (inside_max - inside_min) over all possible subsegments is the same as the global_max - global_min. But that can't be, because the subsegment can't be the entire array. \n\nWait, the maximum (inside_max - inside_min) for any proper subsegment would be the global_max - global_min if there exists a proper subsegment that includes both the global_max and global_min. \n\nOtherwise, it would be the maximum between (global_max - some_min) or (some_max - global_min). \n\nHmm, this is getting too involved. \n\nPerhaps the correct approach is to realize that the maximum beauty is the maximum between (global_max - global_min) plus the maximum (inside_max - inside_min) of any proper subsegment, and the maximum (outside_max - outside_min) plus (inside_max - inside_min) for other cases. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is simply the maximum between (global_max - global_min) and the maximum (inside_max - inside_min) of any proper subsegment plus the (outside_max - outside_min) for that subsegment. \n\nBut how to find this maximum efficiently. \n\nHmm, perhaps the maximum is achieved when the subsegment is the entire array except one element. \n\nLet me see for the first example. \n\nThe first example's array is [1,2,3,4,5,6,1,5]. The maximum when excluding the first element (so subsegment is 2-8) gives outside_max=1 (the first element), so outside difference is 0. The inside's max is 6, min 1. So total 0+5=5. \n\nThe optimal subsegment in the example is when excluding the last two elements (the subsegment is up to 6?), but I'm not sure. \n\nAlternatively, the maximum is achieved when the subsegment is such that the outside includes the global_max and global_min, and the inside has a large difference. \n\nHmm, perhaps the maximum beauty is the global_max - global_min plus the maximum (inside_max - inside_min) of any subsegment that doesn't include the global_max or global_min. \n\nBut I'm not sure. \n\nThis is really challenging. \n\nPerhaps I should look for a different approach. \n\nLet me think of the problem differently. \n\nThe beauty is (max_outside - min_outside) + (max_inside - min_inside). \n\nThis can be rewritten as (max_outside + max_inside) - (min_outside + min_inside). \n\nTo maximize this, we need to maximize (max_outside + max_inside) and minimize (min_outside + min_inside). \n\nHmm, but how? \n\nAlternatively, the maximum possible value of (max_outside + max_inside) is the global_max + global_max (if the subsegment includes the global_max and the outside also includes it). But that's not possible because the subsegment and outside are complementary. \n\nWait, the outside and inside are complementary. So if the subsegment includes the global_max, then the outside does not. So the max_outside can be at most the second highest value. \n\nHmm, this is getting too complicated. \n\nPerhaps the correct approach is to precompute for all possible subsegments the four values using the prefix/suffix arrays and range queries, but find a way to do this in O(n) time. \n\nWait, perhaps the maximum beauty is the maximum between (global_max - global_min) and the maximum (inside_max - inside_min) plus the maximum (outside_max - outside_min) for that subsegment. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) for any proper subsegment. \n\nWait, but in the first example, the global difference is 5 (6-1), and the sub's difference is 4 (5-1). So total 9, which matches. \n\nIn the second example's note, the global difference is 200-1=199. The sub's difference is 200-1=199. So total 199+199=398, but the note's answer is 297. So this approach is incorrect. \n\nHmm, so that approach is wrong. \n\nHmm, perhaps the maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments. \n\nTo compute this efficiently, perhaps we can find for each possible position the best possible subsegment ending or starting there. \n\nAlternatively, perhaps the maximum is achieved when the subsegment is the entire array except one element. \n\nLet me see for the second example's note. \n\nThe array is [2,100,1,200,3]. The global_max is 200, global_min is 1. \n\nIf the subsegment is the entire array except the first element (indices 1-4), then the outside is 2. The outside's difference is 0. The inside's max is 200, min 1. So total 0+199=199. \n\nIf the subsegment is the entire array except the second element (indices 0,2-4), then the outside is 100. The outside's difference is 0. The inside's max is 200, min 1. So total 0+199=199. \n\nIf the subsegment is the entire array except the third element (indices 0-1 and 3-4), then the outside is 1. The outside's difference is 0. The inside's max is 200, min 2. So difference 198. Total 198. \n\nIf the subsegment is the entire array except the fourth element (indices 0-3), then the outside is 3. The inside's max is 200, min 1. So total 0+199=199. \n\nIf the subsegment is the entire array except the fifth element (indices 0-3), then the outside is 3. \n\nHmm, but the note's example's answer is 297. So this approach is not yielding that. \n\nHmm, so the maximum must be achieved by a subsegment that is not the entire array minus one element. \n\nIn the note's example, the subsegment is l=3 to r=4 (0-based indices 2 and 3?), giving the outside elements 2,100,3. Their max is 100, min is 2. So difference 98. The inside's max is 200, min 1. So total 98+199=297. \n\nSo this subsegment is of length 2. \n\nHmm, so the maximum can be achieved by a small subsegment. \n\nThis suggests that we need to consider all possible subsegments, but it's computationally impossible for large n. \n\nHmm, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) of any subsegment that does not include the global_max or global_min. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum between (max_a - min_a) and the maximum (max_sub - min_sub) plus the maximum (max_outside - min_outside) for that subsegment. \n\nBut I'm stuck. \n\nPerhaps I should look for a different approach. \n\nLet me think of the following: \n\nThe beauty is (max_outside - min_outside) + (max_inside - min_inside). \n\nThe outside and inside are complementary. \n\nThe maximum possible value of this expression is the maximum over all possible splits of the array into two parts (the inside and outside). \n\nThe maximum can be found by considering all possible splits where the inside is a proper subsegment. \n\nTo compute this efficiently, perhaps we can precompute for each position the maximum and minimum to the left and right. \n\nWait, perhaps the maximum beauty is the maximum of (max_left - min_left) + (max_right - min_right), where the array is split into left and right parts. \n\nBut the split can be anywhere. \n\nWait, for any split point between index i and i+1, the left part is up to i, the right part starts at i+1. \n\nBut the subsegment can be any subsegment, not just a split into two parts. \n\nHmm, but perhaps the maximum is achieved when the subsegment is a single element. \n\nFor example, if the subsegment is a single element x, then the outside is the rest of the array. The outside's max and min are the global max and min excluding x. \n\nThe inside's max and min are x. So the beauty is (max_outside - min_outside) + (x - x) = max_outside - min_outside. \n\nSo the maximum beauty in this case would be the maximum of (max_outside - min_outside) for any single element excluded. \n\nThis could be a candidate for the maximum. \n\nSimilarly, the maximum could be achieved by excluding a single element. \n\nSo perhaps the maximum beauty is the maximum between the following candidates:\n\n1. The maximum (max_outside - min_outside) when excluding any single element. \n\n2. The maximum (max_inside - min_inside) when the subsegment is the entire array except one element. \n\n3. The global_max - global_min plus the maximum (max_inside - min_inside) of any proper subsegment. \n\nBut I'm not sure. \n\nAlternatively, the maximum beauty is the maximum between:\n\n- The maximum (max_outside - min_outside) for any single element excluded. \n\n- The maximum (max_inside - min_inside) for any single element excluded. \n\n- The maximum (max_outside - min_outside) + (max_inside - min_inside) for any subsegment of length 2. \n\nBut this is still not clear. \n\nHmm, perhaps the optimal subsegment is either a single element or a pair of elements. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum between the following:\n\nFor each element a[i], compute the beauty when the subsegment is the entire array except a[i]. \n\nThe beauty would be (max of the rest - min of the rest) + (max of the rest - min of the rest) ? No, wait, the inside is the rest except a[i], so the outside is a[i]. \n\nWait, no. If the subsegment is the entire array except a[i], then the outside is a[i]. So the outside's max and min are a[i]. So their difference is zero. The inside is the rest of the array. So the inside's max and min are the global max and min excluding a[i]. \n\nSo the beauty is (0) + (max_inside - min_inside). \n\nThe maximum of this over all a[i] is a candidate. \n\nAnother candidate is when the subsegment is the entire array except two elements. \n\nBut this is getting too time-consuming. \n\nPerhaps the correct approach is to precompute for each position the maximum and minimum to the left and right, and then compute the maximum for all possible subsegments of length 1 or 2. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) of any proper subsegment. \n\nBut in the second example's note, this would give 199 + 199 = 398, but the correct answer is 297. So this is not correct. \n\nHmm, I'm stuck. \n\nPerhaps I should look for hints in the problem's constraints. \n\nThe problem's constraints are n up to 1e5 and t up to 1e3. So the solution must be O(n) or O(n log n) per test case. \n\nThe first program's code is to be filled in. The current code has a loop over test cases, and inside, the code is missing. \n\nThe code needs to read n and the array, then compute the maximum beauty. \n\nPerhaps the solution is to realize that the maximum beauty is the maximum between (max_a - min_a) and the maximum (max_sub - min_sub) for any proper subsegment. \n\nWait, but in the first example, the global difference is 5, and the sub's difference is 4. So total 5+4=9. \n\nIn the second example's note, the global difference is 199, the sub's difference is 199. So total 199+199=398, but the correct answer is 297. \n\nSo this approach is wrong. \n\nHmm. \n\nAnother Idea: The maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments. \n\nTo compute this efficiently, perhaps the maximum is achieved when the subsegment is the entire array except the first or last element. \n\nBut in the first example, excluding the first element gives a beauty of 5 (inside's difference is 5). \n\nThe optimal is 9, which is higher. \n\nHmm. \n\nPerhaps the maximum is achieved when the subsegment is the entire array except the first and last elements. \n\nIn the first example, excluding first and last elements gives a subsegment of length 6. The outside is the first and last elements (1 and 5). Their max is 5, min 1. So difference 4. The inside's max is 6, min 1. So total 4+5=9. Which matches the example. \n\nAh! So this is the case. \n\nThe subsegment is the entire array except the first and last elements. \n\nThe outside is the first and last elements. \n\nSo the maximum beauty could be achieved by excluding the first and last elements. \n\nHmm, but how to generalize this. \n\nPerhaps the maximum beauty is the maximum of (max of first and last elements) - (min of first and last elements) plus the maximum of the inside's max and min. \n\nWait, in the first example, the first and last elements are 1 and 5. Their max is 5, min 1. So difference 4. The inside's max is 6, min 1. So total 4+5=9. \n\nIn the second example's note, the first and last elements are 2 and 3. Their max is 3, min 2. So difference 1. The inside's max is 200, min 1. So total 1+199=200. But the note's answer is 297. \n\nHmm, so this approach also doesn't work. \n\nHmm, I'm really stuck. \n\nPerhaps I should look for the solution's approach elsewhere. \n\nWait, the problem's beauty is the difference between the outside's max and min plus the inside's max and min. \n\nThe maximum possible value of this is when the outside's max and min are as large as possible and the inside's max and min are also as large as possible. \n\nPerhaps the optimal subsegment is such that the outside contains the global max and the inside contains the global min, or vice versa. \n\nAlternatively, the maximum beauty is the global_max - global_min plus the maximum possible (inside_max - inside_min) for any subsegment that includes the global_max and global_min. \n\nBut I'm not sure. \n\nAlternatively, the maximum beauty is the maximum between (max_a - min_a) and the maximum (max_sub - min_sub) for any proper subsegment plus the (max_outside - min_outside) for that subsegment. \n\nBut how to compute this efficiently. \n\nPerhaps the solution is to realize that the maximum beauty is the maximum between the global_max - global_min and the maximum (max_sub - min_sub) for any proper subsegment plus the (max_outside - min_outside) for that subsegment. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) for any proper subsegment that does not include the global_max or global_min. \n\nBut I'm not sure. \n\nHmm, perhaps the correct approach is to precompute for each position the maximum and minimum to the left and right, and then compute the maximum for all possible subsegments of length 1 or 2. \n\nBut I'm not sure. \n\nAlternatively, perhaps the maximum beauty is the maximum of (max_a - min_a) plus the maximum (max_sub - min_sub) for any proper subsegment. \n\nBut this doesn't work for the second example. \n\nHmm. \n\nPerhaps I should look for the solution's code structure. \n\nThe first program's code is a loop over test cases. Inside, we need to read n and the array. \n\nThe code needs to compute the maximum beauty. \n\nThe code must be O(n) or O(n log n) per test case. \n\nPerhaps the solution is to realize that the maximum beauty is the maximum between the global_max - global_min and the maximum (max_sub - min_sub) for any proper subsegment. \n\nBut in the second example's note, the global_max - global_min is 199, and the maximum sub's difference is 199 (the sub that includes the global_max and global_min). But the outside's difference would be 98, so the total is 297. \n\nSo the maximum beauty is not simply the sum of the two terms. \n\nHmm. \n\nPerhaps the solution is to compute for each possible subsegment the outside's max and min using the prefix and suffix arrays, and the inside's max and min using a sparse table. \n\nThen, iterate over all possible subsegments of length 1, 2, or n-1, since those are the only candidates for maximum. \n\nBut I'm not sure. \n\nAlternatively, the maximum beauty is achieved when the subsegment is the entire array except the first element or the last element. \n\nIn the first example, excluding the first element gives a beauty of 5 (inside's difference is 5). Excluding the last element gives a beauty of (6-1) + (5-1) =5+4=9. \n\nAh! So excluding the last element gives the correct answer. \n\nThe outside is the first element and the last element (since the subsegment is the first n-1 elements). \n\nWait, the subsegment is the first n-1 elements. The outside is the last element. So the outside's max and min are the last element. So their difference is zero. The inside's max is 6, min 1. So total 0+5=5. \n\nHmm, no. \n\nWait, the first example's array is [1,2,3,4,5,6,1,5]. The last element is 5. \n\nIf the subsegment is the first 7 elements (indices 0-6), then the outside is the last element (5). So outside's max and min are 5. Their difference is zero. The inside's max is 6, min 1. So total 0+5=5. \n\nBut the optimal subsegment is the first 7 elements excluding the last element? \n\nHmm, I'm confused. \n\nPerhaps the optimal subsegment is the last two elements (indices 6 and 7). The outside is the first 6 elements. Their max is 6, min 1. So difference 5. The inside's max is 5, min 1. So total 5+4=9. \n\nAh! So this is a subsegment of length 2. \n\nSo the maximum beauty can be achieved by a small subsegment. \n\nThis suggests that the maximum is achieved by a subsegment of length 2. \n\nPerhaps the maximum beauty is the maximum of (max_outside - min_outside) + (max_inside - min_inside) for all possible subsegments of length 2. \n\nThis would be O(n) time. \n\nLet me see: \n\nFor each possible subsegment of length 2 (i and i+1), compute the outside's max and min, and the inside's max and min. \n\nThe inside's max and min are the two elements. \n\nThe outside is the rest of the array. \n\nThe outside's max is the maximum of the entire array except the two elements. \n\nThe outside's min is the minimum of the entire array except the two elements. \n\nThe maximum of this over all pairs would give the maximum beauty. \n\nBut how to compute this efficiently. \n\nThe global_max and global_min can be precomputed. \n\nFor each pair of elements a[i], a[i+1], the outside's max is the global_max if it is not in the pair. Similarly for the min. \n\nSo for each pair, the outside's max is max(global_max excluding a[i] and a[i+1]). \n\nWait, but this requires knowing whether the global_max is in the pair. \n\nHmm, this might be manageable. \n\nLet me think: \n\nCompute global_max and global_min. \n\nFor each pair of elements a[i], a[i+1], the outside's max is:\n\nif global_max is not in the pair, then it's global_max. \n\nelse, it's the second highest value in the array. \n\nSimilarly for the outside's min. \n\nBut this requires precomputing the second highest and second lowest values. \n\nThis could be done. \n\nThen, for each pair, the outside's max is:\n\nif the pair contains the global_max, then the second_max. \n\nelse, global_max. \n\nSimilarly for the min. \n\nThe inside's max and min are max(a[i], a[i+1]) and min(a[i], a[i+1]). \n\nThe beauty for this pair is (outside_max - outside_min) + (inside_max - inside_min). \n\nThe maximum of this over all pairs would be a candidate for the maximum beauty. \n\nAdditionally, we need to consider subsegments of length 1 and length n-1. \n\nFor a subsegment of length 1 (a[i]), the outside's max and min are the global_max and global_min excluding a[i]. \n\nThe inside's max and min are a[i]. \n\nThe beauty is (outside_max - outside_min) + 0. \n\nThe maximum of this over all single elements is another candidate. \n\nSimilarly for subsegments of length n-1. \n\nThis approach would be O(n) time per test case. \n\nThis seems feasible. \n\nLet me see for the first example: \n\nThe global_max is 6, global_min is 1. \n\nThe second_max is 5 (the next highest after 6). \n\nThe second_min is 1 (since the global_min is 1, and there are other 1's). \n\nFor the pair (1,5) (the last two elements), the outside's max is 6 (since the pair doesn't contain 6). The outside's min is 1 (since the pair contains one of the 1's, but there are others). \n\nSo outside_max - outside_min is 5. The inside's max is 5, min 1. So total 5+4=9. \n\nWhich matches the example. \n\nFor the second example's note: \n\nThe array is [2,100,1,200,3]. \n\nGlobal_max is 200, global_min is 1. \n\nSecond_max is 100. \n\nSecond_min is 2. \n\nThe optimal subsegment is the pair (100,1) and (200,3) ? \n\nWait, the optimal subsegment is indices 2 and 3 (1 and 200). \n\nThe outside elements are 2, 100, 3. \n\nThe outside's max is max(2,100,3) =100. \n\nThe outside's min is min(2,100,3) =2. \n\nSo outside difference is 98. \n\nThe inside's max is 200, min 1. \n\nTotal 98+199=297. \n\nFor this pair (indices 2 and 3), the pair contains 200 (the global_max) and 1 (the global_min). \n\nSo the outside's max is the second_max (100), since the pair contains the global_max. \n\nThe outside's min is the second_min (2), since the pair contains the global_min (1). \n\nSo outside_max - outside_min is 100-2=98. \n\nThe inside's max is 200, min 1. \n\nTotal 297. \n\nThis approach would capture this case. \n\nSo the steps are:\n\nFor each test case:\n\n1. Compute global_max and global_min. \n\n2. Compute second_max and second_min. \n\n3. Compute the maximum beauty from subsegments of length 1, 2, and n-1. \n\n4. The maximum among all these is the answer. \n\nWait, but what about longer subsegments? \n\nFor example, a subsegment of length 3 might give a higher value. \n\nBut perhaps the maximum is achieved by a subsegment of length 1, 2, or n-1. \n\nAlternatively, the maximum is among all possible subsegments of length 1, 2, or the entire array except one element. \n\nThis would reduce the computation to O(n) time. \n\nSo the plan is:\n\nCompute the maximum beauty among all possible subsegments of length 1, 2, or n-1. \n\nThis would be feasible. \n\nLet me see for the first example's optimal subsegment (length 2), it is captured. \n\nFor the second example's optimal subsegment (length 2), it is captured. \n\nAnother example: if the optimal subsegment is of length 3, but the maximum is captured by a shorter subsegment. \n\nBut perhaps this approach works. \n\nSo the steps are:\n\nFor each test case:\n\n- Compute global_max and global_min. \n\n- Compute second_max and second_min. \n\n- Compute the maximum beauty for subsegments of length 1, 2, and n-1. \n\n- The maximum among these is the answer. \n\nWait, but what about subsegments of length n-1? \n\nFor example, the subsegment of length n-1 (excluding one element) would have outside as that one element. \n\nThe outside's max and min are the element itself. So their difference is zero. \n\nThe inside's max and min are the global_max and global_min excluding that element. \n\nSo the beauty is (0) + (max_inside - min_inside). \n\nThe maximum of this over all elements is a candidate. \n\nSo the steps are:\n\nCompute the following candidates:\n\n1. For all single elements (subsegments of length n-1):\n\n   The beauty is (0) + (max_inside - min_inside). \n\n   The max_inside is the global_max excluding the excluded element. \n\n   The min_inside is the global_min excluding the excluded element. \n\n   So for each element a[i], compute the max and min of the array excluding a[i]. \n\n   The maximum of (max - min) over all a[i] is a candidate. \n\n2. For all pairs of elements (subsegments of length 2):\n\n   The beauty is (outside_max - outside_min) + (max(a[i],a[i+1]) - min(a[i],a[i+1])). \n\n   To compute outside_max and outside_min:\n\n   - outside_max is global_max if the pair doesn't contain global_max, else second_max. \n\n   - outside_min is global_min if the pair doesn't contain global_min, else second_min. \n\n   So for each pair, compute this and track the maximum. \n\n3. For subsegments of length n-1 (excluding one element):\n\n   The beauty is (max_inside - min_inside). \n\n   Which is the same as the first candidate. \n\nSo the first and third candidates are the same. \n\nThus, the maximum beauty is the maximum between the first candidate (max of (max_inside - min_inside) for excluding any single element) and the second candidate (max of the pair's beauty). \n\nAdditionally, we need to consider the case where the subsegment is the entire array except two elements. \n\nBut this might be too time-consuming. \n\nAlternatively, the maximum is the maximum between the first and second candidates. \n\nLet me see for the first example:\n\nThe first candidate (max of (max_inside - min_inside) for excluding any single element):\n\nFor example, excluding the last element (5), the inside's max is 6, min 1. So difference 5. \n\nExcluding the first element (1), the inside's max is 6, min 1. So difference 5. \n\nExcluding the element 6 (the global_max), the inside's max is 5, min 1. So difference 4. \n\nThe maximum among these is 5. \n\nThe second candidate (pairs) gives 9. \n\nSo the maximum is 9. \n\nFor the second example's note:\n\nThe first candidate's maximum is 199 (excluding the 1, the inside's max is 200, min 2. So difference 198. Excluding the 200, the inside's max is 100, min 1. So difference 99. Excluding the 1, the inside's max is 200, min 2. So difference 198. The maximum is 198. \n\nThe second candidate's maximum is 297 (the pair of 1 and 200). \n\nSo the maximum is 297. \n\nThis approach works for these examples. \n\nThus, the solution is to compute the maximum between the two candidates. \n\nNow, how to compute the first candidate efficiently. \n\nThe first candidate requires for each element a[i], the maximum and minimum of the array excluding a[i]. \n\nThis can be done with prefix and suffix arrays. \n\nFor each position i, the max excluding a[i] is the maximum between the prefix_max[i-1] and suffix_max[i+1]. \n\nSimilarly for the min. \n\nThus, for each i in 0..n-1:\n\nmax_without_i = max( prefix_max[i-1], suffix_max[i+1] )\n\nmin_without_i = min( prefix_min[i-1], suffix_min[i+1] )\n\nThe difference is max_without_i - min_without_i. \n\nThe maximum of these is the first candidate. \n\nThe second candidate requires for each pair of consecutive elements (i and i+1):\n\ncompute outside_max and outside_min. \n\nTo compute outside_max:\n\nif the pair contains the global_max, then outside_max is the second_max. \n\nElse, it's global_max. \n\nSimilarly for outside_min. \n\nBut how to compute second_max and second_min? \n\nWe can precompute the second_max and second_min. \n\nAlternatively, for each pair, we can compute whether the pair contains the global_max or global_min. \n\nBut this might be time-consuming. \n\nAlternatively, we can precompute the second_max and second_min. \n\nTo compute second_max:\n\n- Find the maximum element, then find the second maximum. \n\nThis can be done in O(n) time. \n\nSimilarly for second_min. \n\nOnce we have global_max, second_max, global_min, second_min, then for each pair:\n\nif a[i] == global_max or a[i+1] == global_max:\n\n   outside_max = second_max \n\nelse:\n\n   outside_max = global_max \n\nSimilarly for outside_min. \n\nBut this is only true if the global_max is not in the pair. \n\nWait, no. \n\nThe outside_max is the maximum of the array excluding the two elements in the pair. \n\nSo if the pair contains the global_max, then the outside_max is the second_max. \n\nOtherwise, it's the global_max. \n\nSimilarly for the min. \n\nThus, for each pair (i, i+1):\n\noutside_max = global_max \n\nif either a[i] or a[i+1] is global_max:\n\n   outside_max = second_max \n\nif both are global_max (but that's possible only if there are multiple global_max elements), then the outside_max is the second_max. \n\nSimilarly for the min. \n\nThus, the steps are:\n\nFor each test case:\n\n1. Read the array a. \n\n2. Compute global_max = max(a), global_min = min(a). \n\n3. Compute second_max: the second highest value in the array. \n\n   To compute this:\n\n   - Iterate through the array, track the first and second maximum. \n\n   Similarly for second_min. \n\n4. Precompute prefix_max, prefix_min, suffix_max, suffix_min arrays. \n\n5. Compute the first candidate: the maximum of (max_without_i - min_without_i) for all i. \n\n   This requires for each i:\n\n   max_without_i = max( prefix_max[i-1], suffix_max[i+1] )\n\n   min_without_i = min( prefix_min[i-1], suffix_min[i+1] )\n\n   compute the difference and track the maximum. \n\n6. Compute the second candidate: the maximum over all pairs (i, i+1) of:\n\n   outside_max = global_max \n\n   if a[i] == global_max or a[i+1] == global_max:\n\n       outside_max = second_max \n\n   outside_min = global_min \n\n   if a[i] == global_min or a[i+1] == global_min:\n\n       outside_min = second_min \n\n   inside_max = max(a[i], a[i+1])\n\n   inside_min = min(a[i], a[i+1])\n\n   beauty = (outside_max - outside_min) + (inside_max - inside_min)\n\n   track the maximum of this. \n\n7. The answer is the maximum between the first and second candidates. \n\nThis approach should work and be O(n) per test case. \n\nNow, implementing this in code. \n\nFor program1.py:\n\nThe code needs to read n and the array. \n\nFirst, compute the prefix and suffix arrays. \n\nThen compute global_max, global_min, second_max, second_min. \n\nThen compute the first candidate. \n\nThen compute the second candidate. \n\nFinally, output the maximum of the two. \n\nNow, let's write the code. \n\nThe code outline:\n\nfor _ in range(int(input())):\n    n = int(input())\n    a = list(map(int, input().split()))\n    if n ==1:\n        # but according to input constraints, n>=4. So no need. \n    # compute global_max and global_min\n    global_max = max(a)\n    global_min = min(a)\n    # compute second_max and second_min\n    # for second_max:\n    first_max = -inf\n    second_max = -inf\n    for num in a:\n        if num > first_max:\n            second_max = first_max\n            first_max = num\n        elif num > second_max:\n            second_max = num\n    # similarly for second_min:\n    first_min = inf\n    second_min = inf\n    for num in a:\n        if num < first_min:\n            second_min = first_min\n            first_min = num\n        elif num < second_min:\n            second_min = num\n    # compute prefix_max, prefix_min\n    prefix_max = [0]*n\n    prefix_min = [0]*n\n    prefix_max[0] = a[0]\n    prefix_min[0] = a[0]\n    for i in range(1, n):\n        prefix_max[i] = max(prefix_max[i-1], a[i])\n        prefix_min[i] = min(prefix_min[i-1], a[i])\n    # compute suffix_max, suffix_min\n    suffix_max = [0]*n\n    suffix_min = [0]*n\n    suffix_max[-1] = a[-1]\n    suffix_min[-1] = a[-1]\n    for i in range(n-2, -1, -1):\n        suffix_max[i] = max(suffix_max[i+1], a[i])\n        suffix_min[i] = min(suffix_min[i+1], a[i])\n    # compute first candidate: max of (max_without_i - min_without_i)\n    first_candidate = 0\n    for i in range(n):\n        # compute max_without_i\n        left_max = prefix_max[i-1] if i>0 else -inf\n        right_max = suffix_max[i+1] if i <n-1 else -inf\n        if left_max == -inf and right_max == -inf:\n            # this can't happen since n>=4 and i is one element\n            pass\n        else:\n            max_without = max(left_max, right_max)\n        # similarly for min_without\n        left_min = prefix_min[i-1] if i>0 else inf\n        right_min = suffix_min[i+1] if i <n-1 else inf\n        min_without = min(left_min, right_min)\n        current_diff = max_without - min_without\n        if current_diff > first_candidate:\n            first_candidate = current_diff\n    # compute second candidate: max over pairs\n    second_candidate = 0\n    for i in range(n-1):\n        a_i = a[i]\n        a_j = a[i+1]\n        # compute outside_max\n        if a_i == global_max or a_j == global_max:\n            outside_max = second_max\n        else:\n            outside_max = global_max\n        # compute outside_min\n        if a_i == global_min or a_j == global_min:\n            outside_min = second_min\n        else:\n            outside_min = global_min\n        inside_max = max(a_i, a_j)\n        inside_min = min(a_i, a_j)\n        current_beauty = (outside_max - outside_min) + (inside_max - inside_min)\n        if current_beauty > second_candidate:\n            second_candidate = current_beauty\n    # also consider the case where the subsegment is the entire array except two elements? \n    # but perhaps the second candidate covers this. \n    # the maximum between first and second candidates\n    ans = max(first_candidate, second_candidate)\n    print(ans)\n\nWait, but what about the case where the subsegment is longer than 2? \n\nFor example, a subsegment of length 3 might give a higher value. \n\nBut according to the examples, the maximum is achieved by a subsegment of length 2. \n\nPerhaps this approach works. \n\nNow, let's test this code with the first example. \n\nFirst example's array: [1,2,3,4,5,6,1,5]. \n\nglobal_max is 6, global_min is 1. \n\nsecond_max is 5 (the next highest after 6). \n\nsecond_min is 1 (since there are multiple 1's). \n\nFor the pair (1,5) (indices 6 and 7):\n\noutside_max: since the pair contains 5 (not the global_max 6), so outside_max is 6. \n\noutside_min: the pair contains 1 (the global_min), so outside_min is second_min (1). \n\nWait, the second_min is 1 because there are multiple 1's. \n\nSo outside_min is second_min, which is 1. \n\nSo outside_max - outside_min is 6-1=5. \n\nInside_max is 5, inside_min is 1. \n\nTotal 5+4=9. \n\nWhich is correct. \n\nFor the second example's note:\n\narray [2,100,1,200,3]. \n\nglobal_max is 200, global_min is 1. \n\nsecond_max is 100. \n\nsecond_min is 2. \n\nThe pair (100,1) (indices 1 and 2):\n\noutside_max: the pair contains 100 and 1. The global_max is 200, which is not in the pair. So outside_max is 200. \n\noutside_min: the pair contains the global_min (1), so outside_min is second_min (2). \n\nSo outside_max - outside_min is 200-2=198. \n\nInside_max is 100, inside_min is 1. \n\nTotal 198 + 99 = 297. \n\nThe pair (1,200) (indices 2 and 3):\n\noutside_max: contains 200 (global_max), so outside_max is second_max (100). \n\noutside_min: contains 1 (global_min), so outside_min is second_min (2). \n\noutside difference: 100-2=98. \n\nInside_max is 200, inside_min is 1. \n\nTotal 98+199=297. \n\nThis is the maximum. \n\nThus, the code would capture this. \n\nNow, the code for program1.py is filled in as above. \n\nNow, moving to program2.py. \n\nThe problem is to count the number of ways to express n as a sum of palindromic numbers, where the order doesn't matter (multiset). \n\nThe constraints are n up to 4e4 and t up to 1e4. \n\nThe code provided is:\n\ng=10**9+7\nv=[1]+[0]*40001\nfor i in range(1,40001):\n    if str(i)==str(i)[::-1]:\n        for j in range(i,40001):# TODO: Your code here\nfor n in[*open(0)][1:]:print(v[int(n)]%g)\n\nThe code is using dynamic programming. \n\nThe idea is that v[j] is the number of ways to form j as a sum of palindromes. \n\nThe code initializes v[0] =1. \n\nFor each palindrome i, we iterate over j from i to 4e4 and update v[j] += v[j -i]. \n\nThis is the standard unbounded knapsack approach. \n\nThe missing code is the inner loop. \n\nThe current code has:\n\nfor i in range(1,40001):\n    if is_palindrome(i):\n        for j in range(i,40001):\n            v[j] += v[j -i]\n            v[j] %= g \n\nThus, the missing code is:\n\nfor j in range(i, 40001):\n    v[j] = (v[j] + v[j -i]) % g \n\nSo the TODO line should be:\n\nfor j in range(i, 40001):\n\nand then inside the loop, v[j] += v[j-i], mod g. \n\nThus, the code for program2.py's missing part is:\n\nThe inner loop should be:\n\nfor j in range(i, 40001):\n    v[j] = (v[j] + v[j-i]) % g \n\nSo the code for program2.py's missing part is the loop and the assignment. \n\nNow, program3.py. \n\nThe problem is to determine if it's possible to make all a_i for i>=2 zero by repeatedly subtracting a_{i-1} from a_i. \n\nThe code provided has a function diff_ops which returns whether all a_i are divisible by a_1. \n\nThe test cases are read, but the code for reading them is incomplete. \n\nThe current code:\n\nimport sys\n\ndef diff_ops(arr):\n    result = True\n    for i in range(1, len(arr)):\n        result = result and arr[i] % arr[0] == 0\n    return result\n\nif __name__ == \"__main__\":\n    input_arr = list(map(int, sys.stdin.read().split()))\n    len_input = len(input_arr)\n    n = input_arr[0]\n    test_cases = []\n    pos = 1\n    while pos <= len_input - 1:\n        # TODO: Your code here\n    for case in test_cases:\n        print(\"YES\" if diff_ops(case) else \"NO\")\n\nThe problem requires that after some operations, all a_i for i>=2 are zero. \n\nThe key insight is that the final array must be [a_1, 0, 0, ..., 0]. \n\nThe operations allow us to subtract a_{i-1} from a_i any number of times. \n\nThis is equivalent to being able to reduce a_i to zero modulo a_1. \n\nWait, the operations are similar to the Euclidean algorithm. \n\nThe process can be viewed as follows: \n\nEach a_i must be a multiple of a_1. \n\nBecause each operation on a_i reduces it by a multiple of a_{i-1}. \n\nBut the process must eventually reach zero. \n\nThe key is that all elements must be divisible by a_1. \n\nBecause each step reduces a_i by multiples of a_{i-1}, but the initial a_1 remains unchanged. \n\nThus, the condition is that every element in the array must be divisible by a_1. \n\nThe function diff_ops checks exactly this. \n\nThus, the code's current function is correct. \n\nThe missing part is reading the test cases properly. \n\nThe input is multiple test cases. \n\nThe first line is t. \n\nThen for each test case: \n\nThe first line is n, then the next line has n numbers. \n\nThe current code reads all input into input_arr. \n\nThe first element is t, then for each test case, the next two elements are n and the array. \n\nThe code needs to read the test cases properly. \n\nThe current code has:\n\npos =1 \n\nwhile pos <= len_input -1:\n\n    # read n \n\n    n = input_arr[pos]\n\n    pos +=1 \n\n    # read the next n elements \n\n    arr = input_arr[pos: pos+n]\n\n    test_cases.append(arr)\n\n    pos +=n \n\nThus, the missing code is:\n\nwhile pos <= len_input -1:\n\n    n = input_arr[pos]\n\n    pos +=1\n\n    arr = input_arr[pos:pos+n]\n\n    test_cases.append(arr)\n\n    pos +=n \n\nThus, the code for the TODO section is:\n\nwhile pos <= len_input -1:\n\n    n = input_arr[pos]\n\n    pos +=1\n\n    arr = input_arr[pos:pos+n]\n\n    test_cases.append(arr)\n\n    pos +=n \n\nSo putting it all together, the missing code for program3.py is the loop and the reading of the test cases. \n\nThus, the three programs' missing parts are:\n\nprogram1.py: the code outlined above. \n\nprogram2.py: the inner loop and assignment. \n\nprogram3.py: the loop to read test cases. \n\nNow, formatting the answer as JSON with the missing code for each program. \n\nThe code for program1.py is the code I outlined earlier. \n\nBut the user's code for program1.py has the initial loop and the TODO. \n\nThe user's code for program1.py:\n\nfor _ in range(int(input())):\n    # TODO: Your code here\n\nThe missing code is the entire block inside the loop. \n\nThe code I outlined earlier is the complete code for the loop body. \n\nThus, the completion for program1 is the code inside the loop. \n\nSimilarly for the other programs. \n\nNow, the final answer is the JSON with the three completions. \n\nThe code for program1.py's completion is the entire block inside the loop. \n\nThe code for program2.py's completion is the inner loop and the assignment. \n\nThe code for program3.py's completion is the loop to read the test cases. \n\nNow, writing the JSON:\n\n{\n    \"program1\": \"\"\"\n    n = int(input())\n    a = list(map(int, input().split()))\n    global_max = max(a)\n    global_min = min(a)\n    # compute second_max and second_min\n    first_max = -float('inf')\n    second_max = -float('inf')\n    for num in a:\n        if num > first_max:\n            second_max, first_max = first_max, num\n        elif num > second_max:\n            second_max = num\n    first_min = float('inf')\n    second_min = float('inf')\n    for num in a:\n        if num < first_min:\n            second_min, first_min = first_min, num\n        elif num < second_min:\n            second_min = num\n    # compute prefix and suffix arrays\n    prefix_max = [0]*n\n    prefix_min = [0]*n\n    prefix_max[0] = a[0]\n    prefix_min[0] = a[0]\n    for i in range(1, n):\n        prefix_max[i] = max(prefix_max[i-1], a[i])\n        prefix_min[i] = min(prefix_min[i-1], a[i])\n    suffix_max = [0]*n\n    suffix_min = [0]*n\n    suffix_max[-1] = a[-1]\n    suffix_min[-1] = a[-1]\n    for i in range(n-2, -1, -1):\n        suffix_max[i] = max(suffix_max[i+1], a[i])\n        suffix_min[i] = min(suffix_min[i+1], a[i])\n    # compute first candidate\n    first_candidate = 0\n    for i in range(n):\n        left_max = prefix_max[i-1] if i >0 else -float('inf')\n        right_max = suffix_max[i+1] if i <n-1 else -float('inf')\n        max_without = max(left_max, right_max) if left_max != -float('inf') or right_max != -float('inf') else 0\n        left_min = prefix_min[i-1] if i>0 else float('inf')\n        right_min = suffix_min[i+1] if i <n-1 else float('inf')\n        min_without = min(left_min, right_min)\n        current_diff = max_without - min_without\n        if current_diff > first_candidate:\n            first_candidate = current_diff\n    # compute second candidate\n    second_candidate = 0\n    for i in range(n-1):\n        a_i = a[i]\n        a_j = a[i+1]\n        if a_i == global_max or a_j == global_max:\n            outside_max = second_max\n        else:\n            outside_max = global_max\n        if a_i == global_min or a_j == global_min:\n            outside_min = second_min\n        else:\n            outside_min = global_min\n        inside_max = max(a_i, a_j)\n        inside_min = min(a_i, a_j)\n        current_beauty = (outside_max - outside_min) + (inside_max - inside_min)\n        if current_beauty > second_candidate:\n            second_candidate = current_beauty\n    ans = max(first_candidate, second_candidate)\n    print(ans)\n    \"\"\",\n    \"program2\": \"\"\"\n    for j in range(i, 40001):\n        v[j] = (v[j] + v[j - i]) % g\n    \"\"\",\n    \"program3\": \"\"\"\n    while pos <= len_input - 1:\n        n = input_arr[pos]\n        pos += 1\n        arr = input_arr[pos:pos + n]\n        test_cases.append(arr)\n        pos += n\n    \"\"\"\n}\n\nBut I need to ensure that the code is properly formatted without markdown and as strings. \n\nAlso, in program1's code, the initial 'n = int(input())' is needed. \n\nWait, the user's code for program1 starts with:\n\nfor _ in range(int(input())):\n    # TODO: Your code here\n\nSo the completion should include the entire code inside the loop. \n\nThe code I wrote earlier starts with n = int(input()), which is correct. \n\nThe code for program2's missing part is the inner loop's body. \n\nThe code for program3's missing part is the loop to read the test cases. \n\nThus, the JSON should be as above. \n\nBut I need to ensure that the code is properly formatted as strings without any markdown. \n\nAlso, in program1's code, the 'first_max' and 'second_max' computation may have to handle multiple occurrences of the global_max. \n\nBut the code I wrote should handle that. \n\nThe code for program1's completion is the entire block inside the loop. \n\nThe code for program2's completion is the inner loop's code. \n\nThe code for program3's completion is the loop to read the test cases. \n\nThus, the final answer is the JSON with these three strings."
}